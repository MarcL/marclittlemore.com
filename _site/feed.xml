<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Marc Littlemore</title>
    <description>Technical articles from Marc Littlemore, a full-stack developer, and ex-videogames programmer, with over 26 years of development experience.</description>
    <link>https://www.marclittlemore.com/</link>
    <author>
      <name>Marc Littlemore</name>
      <email>marc@marclittlemore.com</email>
      <uri>https://www.marclittlemore.com</uri>
    </author>
    <atom:link href="https://www.marclittlemore.com/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>2020-04-27T23:00:00.000Z</pubDate>
    <lastBuildDate>2020-04-27T23:00:00.000Z</lastBuildDate>
    <generator>Eleventy</generator><item>
        <title>Different types of software tests</title>
        <description>&lt;div class=&quot;i fw5&quot;&gt;
    &lt;p&gt;üëâüèª Want to learn more about testing your JavaScript code but don&#39;t know where to start? Get my &lt;a href=&quot;/courses/javascript-testing-beginners-course/?signup=testing-page&quot; title=&quot;FREE 7-day beginners testing course&quot;&gt;FREE 7-day testing course&lt;/a&gt; and you&#39;ll be a JavaScript testing expert in no time!&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;Understanding types of software testing&lt;/h2&gt;
&lt;p&gt;New developers often don&#39;t know where to start with testing their code. They know that it&#39;s a good idea but there&#39;s an overwhelming amount of information out there. Common questions and comments I hear are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;What&#39;s a unit test?&lt;/li&gt;
&lt;li&gt;How does it differ from an integration test?&lt;/li&gt;
&lt;li&gt;Should I be writing end-to-end tests?&lt;/li&gt;
&lt;li&gt;I don&#39;t know where to start!&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I&#39;ll help you to understand the differences in testing types and make you a little less scared to get started on your software testing journey.&lt;/p&gt;
&lt;h2&gt;What is a test?&lt;/h2&gt;
&lt;p&gt;This seems like a simple question right but a lot of people get scared when you mention software tests. There&#39;s an easy pattern which you can follow which will simplify how you think about writing tests. It&#39;s known as &lt;strong&gt;Arrange, Act and Assert (AAA)&lt;/strong&gt; and it&#39;s a common way of writing tests.&lt;/p&gt;
&lt;p&gt;Firstly, you need to set up our &lt;strong&gt;pre-conditions&lt;/strong&gt; for the function under test. This is your &lt;strong&gt;Arrange&lt;/strong&gt;. Here you can initialise any objects, or data you need for your test. You can also define the output value you expect from your code after execution.&lt;/p&gt;
&lt;p&gt;Next, you &lt;strong&gt;call your code&lt;/strong&gt; with the specified inputs for your test. This is your &lt;strong&gt;Act&lt;/strong&gt;. Call your function or method with the given input as though you were calling the code in production.&lt;/p&gt;
&lt;p&gt;Lastly, you will &lt;strong&gt;verify your expectations&lt;/strong&gt; based upon either the output value, or the code paths executed. This is your &lt;strong&gt;Assert&lt;/strong&gt;. You know what you expect your code to do so you can now check that it happened. If it didn&#39;t, then the test has failed and your code, or sometimes your test, is incorrect.&lt;/p&gt;
&lt;h2&gt;Unit tests&lt;/h2&gt;
&lt;p&gt;Most of the code that you write will need to interact with other code. It&#39;ll call another function or class method in some way. We want to split up our code into the smallest &lt;strong&gt;unit&lt;/strong&gt; that it makes sense to test. Most of my projects are written in JavaScript using Node.js so for me this is typically a function. We then test this small piece of code. Testing a small amount of code is known as a &lt;strong&gt;unit test&lt;/strong&gt;. If your test still has to allow your code to use an external service, for example an API request or database call, then it&#39;s not a unit test.&lt;/p&gt;
&lt;p&gt;A &lt;strong&gt;unit test&lt;/strong&gt; should be one of the most basic tests you have. As you want to test the code in isolation, you might have to stub or mock some external dependencies to define specific scenarios. You&#39;ll find that writing unit tests often helps to define the structure and design of your code. If it&#39;s difficult to test, it&#39;s often a &lt;a href=&quot;https://en.wikipedia.org/wiki/Code_smell&quot;&gt;code smell&lt;/a&gt; that means you could refactor your code to make it easier to test.&lt;/p&gt;
&lt;p&gt;One major factor which defines a &lt;strong&gt;unit test&lt;/strong&gt; is its speed. Due to the isolation of the code from its other dependencies, you expect these tests to be incredibly fast. You will often end up writing a lot more unit tests than you will the other test types. A typical unit test suite may have thousands of tests and you&#39;d expect a single test to take much less than a second to run.&lt;/p&gt;
&lt;h2&gt;Integration tests&lt;/h2&gt;
&lt;p&gt;While your unit tests aim to be simple and test a single module or function, &lt;strong&gt;integration tests&lt;/strong&gt;, as their name suggest, tests how code modules fit together in your application (i.e. how they integrate). In your unit tests, the aim is to isolate the external dependencies but for your integration tests, you may allow your code to communicate with data sources like your database, or also external APIs. This isn&#39;t a requirement and you can still mock these external dependencies if you want to.&lt;/p&gt;
&lt;p&gt;Integration tests allow you to test the full flow of your application and test how code modules interface with each other. The classic gif below shows what could happen if you have unit tests for your project and no integration tests. Both unit tests appear to pass correctly, but when the code for both is combined, it&#39;s actually incorrect.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://gallery.mailchimp.com/72d3502c470827973d3e8dd63/images/3f98393a-27c9-4576-ba70-38a464d2f8ae.gif&quot; alt=&quot;Unit vs integration tests&quot;&gt;&lt;/p&gt;
&lt;p&gt;Integration tests are generally slower than your unit tests so you&#39;ll often have fewer of them to test complete code paths. You may need configuration of external applications, like databases or HTTP requests to external APIs, if they&#39;re not mocked out. These types of tests are great for testing higher level logic and data flow through your application.&lt;/p&gt;
&lt;p&gt;An example of an &lt;strong&gt;integration test&lt;/strong&gt; is to test the full flow of an API on a server. This may involve starting a server which runs your application code, responding to HTTP requests, authorising a client or user, validating query parameters or body data, connecting to a database or other APIs, converting data to JSON, and eventually returning the data.&lt;/p&gt;
&lt;p&gt;One thing to consider is that you can still mock external dependencies if you want to. It&#39;s often better to have a thin wrapper around an external service which can return fake data in your integration tests. This still allows you to test your complete application flow as an &lt;strong&gt;integration test&lt;/strong&gt;, but not talk to a production API or database. A good example would be an application which uses the Twitter API to send tweets. You wouldn&#39;t want it to send a tweet every time you ran your test suite!&lt;/p&gt;
&lt;h2&gt;Functional / End-to-end tests&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Function tests&lt;/strong&gt; are also know as &lt;strong&gt;end-to-end (E2E) tests&lt;/strong&gt; and they test the complete functionality of your code. They runn the complete application, usually in a browser, without mocking any external dependencies at all. These types of tests are the slowest to run so you&#39;ll generally have a lot less of these than integration or unit tests.&lt;/p&gt;
&lt;p&gt;An example of a &lt;strong&gt;functional test&lt;/strong&gt; is to verify that a user can sign into a website and that they can view the expected data once authorised. This test would use automated browser interaction to enter the username and password and click on the sign-in button. The test would verify that the title of the next page is as expected and that the user&#39;s data is displayed. This is often done by querying the DOM to determine if elements are present. There are a lot of pre-conditions for this test, such as having a valid username and password combination, and knowning the DOM elements to verify. This means that functional tests are often more brittle and prone to breaking than unit or integration tests. Be wary of relying on user interface data for test expectations as developers or designers often change it!&lt;/p&gt;
&lt;h2&gt;Test doubles&lt;/h2&gt;
&lt;p&gt;When writing tests, there are rarely functions or classes that operate in isolation. Most code interacts with other modules in some way. If you want to isolate your function for testing you can use a &lt;strong&gt;test double&lt;/strong&gt;. This is the generic term for when you replace a production object for testing purposes with a fake. Think of it like a film where a &lt;em&gt;stunt double&lt;/em&gt; replaces the actual actor for the dangerous scenes.&lt;/p&gt;
&lt;p&gt;There are various kinds of test doubles that you can use in your tests and there will be different uses for each of them.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Dummy&lt;/strong&gt; - A dummy object is used in place of your production object and will match the interface of the thing it replaces. However, you don&#39;t care what it does. Think of it as a simple placeholder which you&#39;ll need as one of your function parameters.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Stub&lt;/strong&gt; - A stub is an object or function which responds with a pre-programmed response. It normally only responds to what has been programmed for the test.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Spy&lt;/strong&gt; - A spy is a function which wraps an object and can record information about how the object is used. This is useful for avoiding altering the behaviour of the function, but still determining how it was interacted with.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mock&lt;/strong&gt; - Mocks are fake objects which have fake methods. They also have pre-programmed responses like stubs. However, the main difference to spies and stubs is that they also have pre-programmed expectations. If the mock is not used as expected by your code, the test will fail.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Fake&lt;/strong&gt; - A fake object is similar to a stub and it will return some expected values. However, it also implements some of the functionality of the object it&#39;s replacing. An example would be an in-memory data store which replaces the production database.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Watch the video&lt;/h2&gt;
&lt;p&gt;Hopefully this been a brief but helpful walkthrough of the different types of software tests you can write. I&#39;ve recorded a video which summarises what you&#39;ve learnt. I talk about the different types of tests you might write as a developer and give some information on test doubles and some of the tools that exist in the JavaScript universe which will help you to write tests. You can watch it here:&lt;/p&gt;
&lt;div class=&quot;aspect-ratio aspect-ratio--16x9 overflow-hidden mw-100&quot;&gt;
    &lt;iframe
        class=&quot;absolute top-0 left-0 w-100 h-100&quot;
        src=&quot;https://www.youtube.com/embed/&quot;
        frameborder=&quot;0&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;/div&gt;
&lt;p&gt;If this post was valuable to you, you can &lt;a href=&quot;https://twitter.com/marclittlemore&quot;&gt;follow my journey on Twitter&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Want to learn more about JavaScript testing?&lt;/h2&gt;
&lt;div class=&quot;i fw5&quot;&gt;
    &lt;p&gt;üëâüèª Want to learn more about testing your JavaScript code but don&#39;t know where to start? Get my &lt;a href=&quot;/courses/javascript-testing-beginners-course/?signup=testing-page&quot; title=&quot;FREE 7-day beginners testing course&quot;&gt;FREE 7-day testing course&lt;/a&gt; and you&#39;ll be a JavaScript testing expert in no time!&lt;/p&gt;
&lt;/div&gt;
</description>
        <pubDate>Mon, 27 Apr 2020 23:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/different-types-of-software-tests/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/different-types-of-software-tests/</guid>
      </item><item>
        <title>How to add time and date to your Messenger chatbot using the Chatfuel JSON API</title>
        <description>&lt;div class=&quot;i fw5&quot;&gt;
    &lt;p&gt;üëâüèª Want to learn more about JSON? Want to learn about the magic of JSON without being a developer? Get my &lt;a href=&quot;/bots/sign-up-bot-building-for-beginners/&quot; title=&quot;FREE JSON guide&quot;&gt;FREE JSON guide&lt;/a&gt; and you&#39;ll have JSON skills in no time!&lt;/p&gt;
&lt;/div&gt;
&lt;h2&gt;Watch the video&lt;/h2&gt;
&lt;div class=&quot;aspect-ratio aspect-ratio--16x9 overflow-hidden mw-100&quot;&gt;
    &lt;iframe
        class=&quot;absolute top-0 left-0 w-100 h-100&quot;
        src=&quot;https://www.youtube.com/embed/&quot;
        frameborder=&quot;0&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;/div&gt;
&lt;p&gt;One of the main benefits of creating a Facebook Messenger chatbot is that you don&#39;t have to be present to answer messages for 24 hours per day. Your chatbot should be on hand to do this while you&#39;re fast asleep. What would be even better is if it could understand where your user lives and give them relevant content for their time of day. It could let them know whether your shop is open for business. Or it could send your users the breakfast menu rather than the dinner menu because it knows it&#39;s 9am where they are. This functionality doesn&#39;t exist in Chatfuel by default so let me teach you how to build an API which adds time and date functions to your chatbot.&lt;/p&gt;
&lt;h2&gt;Timezones &amp;amp; Coordinated Universal Time&lt;/h2&gt;
&lt;p&gt;When your users talk to you on Facebook Messenger, they may live anywhere around the world. This means we need to know what the time is where they live. Each user can potential live in a different &lt;a href=&quot;https://en.wikipedia.org/wiki/Time_zone&quot;&gt;time zone&lt;/a&gt;. This means we may need to add or subtract a number of hours to the time where your server is to allow for this time difference. Although you might think that it&#39;s always a whole number of hours, there are time zones which have half hours too. But what time is it where your API server is hosted? Well, this depends on where the data centre is that is storing and executing your code. What happens if your server is in New York, which is 5 hours behind &lt;a href=&quot;https://en.wikipedia.org/wiki/Greenwich_Mean_Time&quot;&gt;Greenwich Mean Time&lt;/a&gt; (GMT), but your user is Germany, which is 1 hour ahead of GMT. And what happens if &lt;a href=&quot;https://en.wikipedia.org/wiki/Daylight_saving_time&quot;&gt;daylight saving time&lt;/a&gt; has happened in one of those countries? Calculating the time is hard and things can get even more complicated. That&#39;s why we have a time standard which everyone uses. It&#39;s called &lt;a href=&quot;https://en.wikipedia.org/wiki/Coordinated_Universal_Time&quot;&gt;Coordinated Universal Time&lt;/a&gt; or UTC. The Wikipedia page will explain why it&#39;s not an acronym of CUT! Using UTC allows us to define all times as relative to this standard. If we store all of our times in UTC, life becomes a bit easier.&lt;/p&gt;
&lt;h2&gt;Calculating a user&#39;s time&lt;/h2&gt;
&lt;p&gt;I&#39;ve set up an &lt;a href=&quot;https://glitch.com/edit/#!/chatfuel-demo-bot?path=routes/timeDate.js:1:0&quot;&gt;example Node.js Express server using Glitch&lt;/a&gt; which exposes an API for all of my Chatfuel demos. The API for this article is available on the following endpoint:&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://chatfuel-demo-bot.glitch.me/timedate&quot;&gt;https://chatfuel-demo-bot.glitch.me/timedate&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The first thing we need to do is to calculate the user&#39;s local time using UTC. JavaScript (and Node.js) has a global object called &lt;code&gt;Date&lt;/code&gt; which expose a set of methods we can use to determine and manipulate the date and time. First, we need to determine the time right now. We can use the &lt;code&gt;Date.now()&lt;/code&gt; function which will return us the UTC &lt;a href=&quot;https://en.wikipedia.org/wiki/Unix_time&quot;&gt;epoch time&lt;/a&gt;. This is the number of milliseconds since the start of UNIX time (at 00:00 on January 1st, 1970). We can then use this to calculate how many milliseconds difference between the user&#39;s timezone and the time now. Using JavaScript&#39;s &lt;code&gt;Date&lt;/code&gt; object, we can then inspect this and pull out the date and time to use in our chatbot. Let&#39;s look at some code to do this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;// Calculate the number of milliseconds in an hour
// - 1000 milliseconds in a second,
// - 60 seconds in a minute
// - 60 minutes in an hour
const ONE_HOUR_IN_MILLISECONDS = 60 * 60 * 1000;

// Pass in an offset in hours which we use to calculate the user&#39;s time
const getUserDateInTimezone = offsetInHours =&amp;gt; {
    // Calculate the UNIX timestamp in UTC
    const utcDate = Date.now();
  
    // Get the user&#39;s offset in milliseconds
    // The offsetInHours could be a negative number if
    // the user&#39;s timezone is behind UTC
    const offsetInMilliseconds = ONE_HOUR_IN_MILLISECONDS * offsetInHours;
  
    // Create a new Date object which adds the time offset to the time now
    return new Date(utcDate + offsetInMilliseconds);
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once we&#39;ve written a function to calculate a new &lt;code&gt;Date&lt;/code&gt; object, we can use the built in functions to inspect the data and return it to our user. As we&#39;re using Express to expose an API, we&#39;ll use its routing methods to expose a HTTP GET endpoint which allows our Chatfuel chatbot to make a request using the JSON API. We will allow it to pass through a timezone as a query parameter which Facebook Messenger can provide us. We can then set some user attributes which are returned to Chatfuel and can be used in our chatbot flows. Let&#39;s look at how we can do this:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;const express = require(&#39;express&#39;);
const router = express.Router();

// ... add the time calculation code from above here

router.get(&#39;/&#39;, (request, response) =&amp;gt; {
    // Allow a query parameter called &amp;quot;timezone&amp;quot; to be passed with the GET request
    // Default it to zero if we don&#39;t send one
    const {timezone = 0} = request.query;

    // Calculate the user&#39;s current Date in UTC using our code from above
    const userDateInTimezone = getUserDateInTimezone(timezone);
  
    // Inspect the Date object and pull out the data we need
    // Build an object which we can return to Chatfuel
    const dateObject = {
        // Get the day
        day: userDateInTimezone.getDate(),
        
        // Note that month is zero-indexed (from 0 for January to 11 for December)
        // For it to make sense for an actual month number, add one to it!
        month: userDateInTimezone.getMonth() + 1,
        
        // Get the full 4-digit year e.g. 2020
        year: userDateInTimezone.getFullYear(),

        // Get the number of hours
        hours: userDateInTimezone.getHours(),

        // Get the number of minutes
        minutes: userDateInTimezone.getMinutes(),

        // Get the number of seconds
        seconds: userDateInTimezone.getSeconds(),

        // Get a standard ISO-8601 formatted string
        isoTime: userDateInTimezone.toISOString()
    };

    // Format the data so that Chatfuel can set user attributes
    const userAttributes = {
        set_attributes: dateObject
    };

    // Return a JSON response that Chatfuel can understand
    response.json(userAttributes);
});

// If we&#39;re putting our routes into separate modules for clarity
// then we need to export the routes for use in the Express application
module.exports = router;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The last thing you need to do is to use this code in your Chatfuel chatbot. You can use the redirect blocks to check the value of &amp;quot;hours&amp;quot; returned after calling your API. If they are greater than 18, or 6pm, you could consider it to be evening and change the user responses accordingly. In a similar way, you can check if the value is greater than 6, or 6am, and then consider it to be breakfast time. Once you&#39;ve got the user&#39;s time and date, you can give timely responses to your user. Watch &lt;a href=&quot;https://www.youtube.com/watch?v=UDrGpc4Dp8w&quot;&gt;my video&lt;/a&gt; for more examples.&lt;/p&gt;
&lt;p&gt;All of the code is available on my &lt;a href=&quot;https://glitch.com/~chatfuel-demo-bot&quot;&gt;Chatfuel demo Glitch project&lt;/a&gt;. Feel free to clone it and use it for your own APIs. If you spot any errors, or have any questions, then please &lt;a href=&quot;/contact&quot;&gt;send me a message&lt;/a&gt;. I love to hear from people and I&#39;m always happy to answer your questions.&lt;/p&gt;
&lt;div class=&quot;i fw5&quot;&gt;
    &lt;p&gt;üëâüèª Want to learn more about JSON? Want to learn about the magic of JSON without being a developer? Get my &lt;a href=&quot;/bots/sign-up-bot-building-for-beginners/&quot; title=&quot;FREE JSON guide&quot;&gt;FREE JSON guide&lt;/a&gt; and you&#39;ll have JSON skills in no time!&lt;/p&gt;
&lt;/div&gt;
</description>
        <pubDate>Fri, 14 Feb 2020 00:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/how-to-add-time-and-date-to-your-messenger-chatbot-using-the-chatfuel-json-api/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/how-to-add-time-and-date-to-your-messenger-chatbot-using-the-chatfuel-json-api/</guid>
      </item><item>
        <title>2019: Personal Retrospective</title>
        <description>&lt;p&gt;I started my 2020 by thumbing through Twitter as I often do, and often try to avoid doing. Between the technology and political tweets were personal 2019 reviews and retrospectives.
In software development, we use the idea of the &lt;a href=&quot;https://www.scrum.org/resources/what-is-a-sprint-retrospective&quot;&gt;agile sprint retrospective&lt;/a&gt;). A sprint is a period in which you attempt to produce new features for your software application. A sprint retrospective is a team meeting when you discuss how the last sprint went. What went well, what could have gone better, and any actions to make sprints better. These personal reviews took this idea and applied it to their lives. Here is my personal 2019 retrospective.&lt;/p&gt;
&lt;h2&gt;What went well?&lt;/h2&gt;
&lt;p&gt;One of my big goals every year is to spend quality time with &lt;a href=&quot;https://clarelittlemore.com&quot;&gt;Clare&lt;/a&gt; and our children. This year, we had a fantastic holiday to Disney World and Universal Studios in Florida. We planned to go in 2018, but issues with my feet changed our plans. While I had some toe issues before and after the holiday, we managed to walk for five miles on most days. A fantastic holiday! As the family loves theatre, we saw a surprising amount of musicals and plays throughout the year. The children also performed in four shows and I&#39;m proud of how far they&#39;ve come with their acting and singing.&lt;/p&gt;
&lt;p&gt;Another major goal was to ensure I saw more of my friends. Once you hit your 40s, you end up with more family commitments so seeing old friends becomes harder. This year I had two major get-togethers with a great group of mates. The first one involved far too much gin! As we all head towards the wrong side of our 40s, I also managed to celebrate a couple of 50th birthdays. Music has always been a major part of my life and I saw more live music in 2019. Thanks to some tickets for my birthday, I saw &lt;a href=&quot;https://open.spotify.com/album/2D67AgXVKjql7tniG3jQKl&quot;&gt;The Midnight Hour&lt;/a&gt; in Liverpool. This ended with us meeting Ali Shaheed Muhammad from A Tribe Called Quest. A big-time legend from my hip-hop youth. It was also great to see the Loop Daddy himself, &lt;a href=&quot;https://www.marcrebillet.com/&quot;&gt;Marc Rebillet&lt;/a&gt; at Manchester‚Äôs Albert Hall in November. If you don&#39;t know who he is then Google him. Seeing a man improvising songs in a pair of boxer shorts, a silk dressing gown, and patent leather shoes is something to behold. Part comedy. Part sex symbol. Yet he&#39;s a brilliant musician and singer. One of the best live shows I‚Äôve seen! The final gig of the year was &lt;a href=&quot;https://en.wikipedia.org/wiki/Kruder_%26_Dorfmeister&quot;&gt;Kruder &amp;amp; Dorfmeister&lt;/a&gt;. What I thought was going to be a chilled trip-hop experience turned into a middle-aged rave. Banging tunes and a great light show made it a fantastic night.&lt;/p&gt;
&lt;p&gt;For the past three years, I&#39;ve been a Software Engineering Team Lead at the BBC. This means that I build and manage high performing teams and don&#39;t write much code during the day any more. Most of my technology learning happens in the evenings after the kids have gone to bed (which gets much later as they get older!). I wondered how much software I wrote in 2019, so I had a look at my &lt;a href=&quot;https://github.com/MarcL&quot;&gt;GitHub commits&lt;/a&gt; for the whole year. I surprised myself with the number of new technologies I picked up, most of which I hadn&#39;t touched before. These were:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://botkit.ai/&quot;&gt;BotKit&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cloud.google.com/&quot;&gt;Google Cloud Platform&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://firebase.google.com/&quot;&gt;Firebase&lt;/a&gt; location-based API which imports data from &lt;a href=&quot;https://airtable.com/&quot;&gt;Airtable&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.gatsbyjs.org/&quot;&gt;Gatsby&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://graphql.org/&quot;&gt;GraphQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.shopify.co.uk/&quot;&gt;Shopify&lt;/a&gt; applications and &lt;a href=&quot;https://polaris.shopify.com/&quot;&gt;Polaris&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://sparkar.facebook.com/ar-studio/&quot;&gt;Spark AR&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/MarcL/markdown-to-mailchimp&quot;&gt;Markdown to Mailchimp&lt;/a&gt; email generation (as I dislike the Mailchimp WYSIWYG editor!)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/marcl/og-image&quot;&gt;Open Graph image generation&lt;/a&gt; using serverless functions&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://zeit.co/docs&quot;&gt;Zeit Now 2.0&lt;/a&gt; (moving a Now v1.0 API to use their new serverless functions)&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://firebase.google.com/&quot;&gt;Firebase&lt;/a&gt; serverless function to scrape Amazon book rankings&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&quot;https://www.typeform.com/blog/inspiration/business-ideas/&quot;&gt;&amp;quot;Scratching your own itch&amp;quot;&lt;/a&gt; is always a good way to gain more knowledge of areas you&#39;re unfamiliar with. Since 2017 I&#39;ve become an expert in building &lt;a href=&quot;/bots&quot;&gt;Messenger chatbot experiences&lt;/a&gt; and I&#39;ve often used chatbot platforms like &lt;a href=&quot;https://chatfuel.com&quot;&gt;Chatfuel&lt;/a&gt; to build them. As I was consulting for a Messenger-based travel company, they were looking for cheaper options. This led me to build a solution using BotKit hosted using Google Cloud Platform. This was a fantastic learning experience for GCP App Engine, Cloud Firestore. It also allowed me to create a location-based API using Firebase functions and Airtable. Unfortunately, the chatbot isn&#39;t yet live due to a lack of money from the company involved. See also &amp;quot;what didn&#39;t go well&amp;quot;!&lt;/p&gt;
&lt;p&gt;A big win for me this year was deciding to refactor my wife Clare&#39;s author website using Gatsby. The previous incarnation used Wordpress and needed some love. Gatsby also allowed me to learn some GraphQL in the process. This led me to build some Shopify integrations for my chatbot API and understand their integration. My chatbot API needed a bit of love this year as I&#39;d left it to stagnate using the old Zeit Now 1.0 framework. This lets you deploy an Express server and spin up compute instances as needed. Zeit used to host the whole API this way. With their new &lt;a href=&quot;https://zeit.co/blog/now-2&quot;&gt;Zeit Now 2.0&lt;/a&gt;, they pivoted to a serverless approach. The advantage of this allows the API to scale on a per endpoint basis. Yet, this requires a separate function for each API endpoint. While this was a big rewrite on my part, it made my application API much simpler. One observation I have of my 2019 project is that one learning moment leads to another. A problem or unknown solution in the first project often brought a discovery of a new technology which could help. I just wish I&#39;d done more &lt;a href=&quot;https://www.swyx.io/writing/learn-in-public&quot;&gt;learning in public&lt;/a&gt; as &lt;a href=&quot;https://twitter.com/swyx&quot;&gt;Shawn &amp;quot;SWYX&amp;quot; Wang&lt;/a&gt; suggests.&lt;/p&gt;
&lt;p&gt;My work life was pretty good for most of the year. The BBC launched one of its big diversity initiatives - the &lt;a href=&quot;https://www.bbc.co.uk/blogs/internet/entries/29697bc8-9b32-4b41-8d42-33f1ed625859&quot;&gt;&amp;quot;Step Into Tech&amp;quot;&lt;/a&gt; scheme and I became an advocate and advisor for this. It was a 14-week training programme to teach the basics of software engineering to women who were looking for a career change. I helped to mentor four of the 2018 cohort and encouraged them to shadow our team to see what we did. With the help of a senior engineer, all four women made a change to our codebase. They deployed their changes to our live applications, something they should be proud of. One of the women joined us in September, and it&#39;s been rewarding to mentor and guide her new journey. I also ended up spending a lot of 2019 hiring and building up my engineering team. By the end of the year, I&#39;d interviewed and hired four fantastic software engineers. Big thanks to my team for their help and support in this. A highlight of my working year was attending the amazing &lt;a href=&quot;https://theleaddeveloper.com/&quot;&gt;Lead Developer conference&lt;/a&gt; in London in June 2019. As a software engineering team lead, it&#39;s much harder to see the impact you make on a team as you no longer write code. This brought together some excellent speakers from the engineering teams across the world. It was fantastic to hear presentations from likeminded team leads, and to hear the challenges of building high functioning teams.&lt;/p&gt;
&lt;p&gt;One of my biggest wins of the year was to use a habit tracker, a Google Sheet, to see where I was spending my time. I wanted to practice &lt;a href=&quot;https://en.wikipedia.org/wiki/Quantified_self&quot;&gt;quantified self&lt;/a&gt; and so recorded statistics about my life for the whole of 2019. I tracked the parts of my life I thought I should improve, such as when I went to bed, when I exercised (or didn&#39;t!) and so on. One of these was reading. I&#39;ve often found it tricky to stick to a regular reading schedule but by recording when I read, I tricked myself into reading more. I finished ten books in 2019 so that&#39;s a personal win for me.&lt;/p&gt;
&lt;h2&gt;What could have gone better?&lt;/h2&gt;
&lt;p&gt;After my &lt;a href=&quot;(/how-i-almost-died)&quot;&gt;near-death experience&lt;/a&gt; in 2014, I knew I should attempt to get more exercise. I&#39;ve encountered a few health issues following my hospitalisation so I spent 2019 attempting to get fit. This began well but as has happened in the past, I wrestled with more issues with my toe. The amputation of my right great toe creates more pressure on the next toe. This means a greater potential for ulcers (holes) in it. It&#39;s a constant balance between more cardio exercise whilst avoiding further complications. My habit tracker showed that I spent 26% of my year exercising. I should have spent more time getting my bike in order and cycling but I didn&#39;t prioritise this. This would avoid any major impact on my feet versus running, which my podiatrist advises me to avoid.&lt;/p&gt;
&lt;p&gt;Since 2017 I&#39;ve become an expert at &lt;a href=&quot;/bots&quot;&gt;building Messenger chatbots&lt;/a&gt;. I acted as a consultant for a London-based travel company based in London at the end of 2018 and the beginning of 2019. This was a side-project which I hoped would lead to more consultancy work. I leveraged the BotKit framework to build a cost-effective bot without the cost of an external platform such as Chatfuel. While this was a great learning experience, I spent a lot of time working on the project to finish the required features. As the company is a startup, it had little spare cash and failed to pay my final invoices. Given the effort I put into the project, this caused frustrations on my part. I had a similar experience in 2018 where I built a &lt;a href=&quot;https://dialogflow.com/&quot;&gt;Dialogflow&lt;/a&gt; and &lt;a href=&quot;https://www.twilio.com/&quot;&gt;Twilio&lt;/a&gt; chatbot for an American entrepreneur and no payment materialised. It&#39;s made me realise that I need to become better at negotiating full payment and contracts up-front.&lt;/p&gt;
&lt;p&gt;As well as developing a better reading habit, I wanted to build a habit of regular writing. I missed the mark with this with only 11% of my days spent writing. My one success here was writing and releasing a 30-page guide to JSON for chatbots (which you can get &lt;a href=&quot;/bots&quot;&gt;here&lt;/a&gt;). I failed to find my writing voice so this is a big goal for me in 2020.&lt;/p&gt;
&lt;p&gt;Since late 2017 I&#39;ve had plans to build an online course. I love helping people and want to share my knowledge with us to generate a side income from it. My JSON guide was my initial &amp;quot;lead magnet&amp;quot; to encourage people onto my mailing list but I failed to capitalise on this. I spent too much time thinking about what I should do rather than creating. I should have been releasing early and often and learning what people want. Paralysis by analysis happens far too often so I&#39;d like to avoid this in 2020.&lt;/p&gt;
&lt;h2&gt;Plans for 2020&lt;/h2&gt;
&lt;p&gt;My main goal for 2020 is being addressed by this blog post as I plan to find my writing &amp;quot;voice&amp;quot;. Since school, I&#39;ve often told myself &amp;quot;I&#39;m not very good at English&amp;quot; and &amp;quot;I&#39;m much better at maths&amp;quot;. I often write in my day job, be it technical papers or tickets, or emails to senior stakeholders. But I rarely write for a wider audience. The plan for 2020 is to blog more often and do a lot more &lt;a href=&quot;https://www.swyx.io/writing/learn-in-public&quot;&gt;learning in public&lt;/a&gt;. I&#39;m will endeavour to write about the technologies that I&#39;m learning, how I&#39;m building my online course, and more.&lt;/p&gt;
&lt;p&gt;As 2019 wasn&#39;t a great year for fitness, I need to get much fitter this year. As I enjoy cycling, I&#39;m going to get outside more on my mountain bike, both alone and with the family. My wife and I are also trying to get the family into a regular habit of getting outside to walk more. We live near some beautiful countryside and it seems a shame not to see more of it. This will combine cardio exercise with fresh air which always helps to clear your head.&lt;/p&gt;
&lt;p&gt;Since stomach surgery in 2014, I&#39;ve had a more difficult relationship with food. I love cooking and have always enjoyed eating great food but I often struggle to eat well. I have to consume much smaller portion sizes and I&#39;m often sick after eating. I now find meat more difficult to digest so I plan to lean towards a more vegetarian diet. This has obvious health benefits for me and also has the potential to help with &lt;a href=&quot;https://www.bbc.co.uk/news/science-environment-49238749&quot;&gt;climate change&lt;/a&gt;. I&#39;d love to head towards a mostly plant-based diet but I like cheese too much. I&#39;ve started the year as more of a &lt;a href=&quot;https://www.bbcgoodfood.com/howto/guide/what-flexitarian-diet&quot;&gt;flexitarian&lt;/a&gt;, with a much-reduced meat diet. I&#39;ll see where this year takes me but I may well be completely vegetarian by the end of the year.&lt;/p&gt;
&lt;p&gt;This year I want to get some traction on my side projects and aim to make a reasonable side income through it. I&#39;ll be publishing &lt;a href=&quot;https://www.youtube.com/c/marclittlemore&quot;&gt;more videos&lt;/a&gt; on YouTube and this will be part of a marketing push to drive more traffic to my website. I am committing to publishing a short course in the first quarter of 2020. I&#39;ll be doing some research in the next couple of weeks and aim to release an outline before the end of January 2020.&lt;/p&gt;
&lt;p&gt;As well as spending more time with the family, I want to get back to some of my old hobbies. I spend most of my evenings reading about technology or writing new software. This hasn&#39;t allowed me enough time for non-tech related hobbies. I increased my rate of reading in 2019 and the goal for 2020 is to read twenty books. I also want to resurrect my old love of making music. I&#39;ve not made any new tracks since the early 2010s so it&#39;s time to dust off the audio interface and MIDI keyboard and get back to making electronic music. 2020 could be the year I dust off the decks and get &lt;a href=&quot;http://www.djcruze.co.uk&quot;&gt;DJ Cruze&lt;/a&gt; rocking the house again. Watch this space!&lt;/p&gt;
&lt;p&gt;I&#39;ve set myself some audacious goals for 2020 but there&#39;s little point in not trying to better myself. I look forward to reviewing them all in 2021 to see how far I&#39;ve travelled. Will I have achieved most of them? Let&#39;s see next year.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This post is inspired &lt;a href=&quot;https://www.knutmelvaer.no/blog/2020/01/2019-a-personal-retrospective/&quot;&gt;Knut Melv√¶r&lt;/a&gt;, &lt;a href=&quot;https://lengstorf.com/2019-personal-retrospective/&quot;&gt;Jason Lengstorf&lt;/a&gt;, &lt;a href=&quot;https://justinjackson.ca/2019-review&quot;&gt;Justin Jackson&lt;/a&gt;, &lt;a href=&quot;https://blog.stephsmith.io/another-year-under-the-sun/&quot;&gt;Steph Smith&lt;/a&gt;, and &lt;a href=&quot;https://www.madisonkanna.com/2019-in-review/&quot;&gt;Madison Kanna&lt;/a&gt;, while listening to the wonderful French band &lt;a href=&quot;http://wearephoenix.com/&quot;&gt;Phoenix&lt;/a&gt; and the album &lt;a href=&quot;https://open.spotify.com/album/2TVvPbLNPTCZS8lPHs1rZW?si=LV0DLrnpRKmnulbSsLIHcw&quot;&gt;Wolfgang Amadeus Phoenix&lt;/a&gt;. A classic from 2009.&lt;/em&gt;&lt;/p&gt;
</description>
        <pubDate>Mon, 06 Jan 2020 00:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/2019-personal-retrospective/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/2019-personal-retrospective/</guid>
      </item><item>
        <title>How to validate an email adress using the Chatfuel JSON API</title>
        <description>&lt;p&gt;Facebook Messenger chatbots are a great addition to your marketing toolbox but they have one big problem.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Facebook controls the platform and can change its rules when it wants to.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Their &lt;a href=&quot;https://developers.facebook.com/docs/messenger-platform/policy/policy-overview/#current_policy&quot;&gt;recent changes to their broadcast and subscription messaging rules&lt;/a&gt; means it&#39;s more difficult to contact users after 24 hours if they&#39;re not engaging with your bot. While stopping people from abusing Messenger messages is the right thing, how to you keep your user&#39;s engaged?&lt;/p&gt;
&lt;p&gt;I always recommend that you should consider Facebook Messenger as one of your marketing channels but you always need a multi-channel marketing approach. That&#39;s why it&#39;s useful to ask your chatbot users for their email address and add them to an email list in your Email Service Provider (ESP) like &lt;a href=&quot;https://mailchimp.com/&quot;&gt;Mailchimp&lt;/a&gt; or &lt;a href=&quot;https://convertkit.com/&quot;&gt;ConvertKit&lt;/a&gt;. Messenger allows you to ask for an email address using one of its quick replies but if the email isn&#39;t available, or the user chooses to type it in, how do we make sure we&#39;ve got valid data?&lt;/p&gt;
&lt;h2&gt;Validating an email using Chatfuel&lt;/h2&gt;
&lt;p&gt;Let&#39;s take a look at how we can validate a given user email using Chatfuel as our chatbot platform. Chatfuel allows you to ask for a user&#39;s email using it&#39;s &amp;quot;Save User Email&amp;quot; element. Adding this to your chatbot flow allows you to send a quick reply to your and ask for an email address which is then stored in a Chatfuel user attribute. If you pass this to your server side API using the JSON API plugin, you can&#39;t validate it on the server to determine if it&#39;s valid.&lt;/p&gt;
&lt;h2&gt;Watch The Video&lt;/h2&gt;
&lt;p&gt;Take a look at how I build this email validation using &lt;a href=&quot;https://glitch.com&quot;&gt;Glitch&lt;/a&gt; and a Node.js Express web server together with Chatfuel&#39;s JSON API.&lt;/p&gt;
&lt;div class=&quot;aspect-ratio aspect-ratio--16x9 overflow-hidden mw-100&quot;&gt;
    &lt;iframe
        class=&quot;absolute top-0 left-0 w-100 h-100&quot;
        src=&quot;https://www.youtube.com/embed/&quot;
        frameborder=&quot;0&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;/div&gt;
&lt;h3&gt;How to validate an email address?&lt;/h3&gt;
&lt;h4&gt;Using a regular expression&lt;/h4&gt;
&lt;p&gt;Validating email addresses correctly can be tricky. One way is to use something called a &lt;a href=&quot;https://en.wikipedia.org/wiki/Regular_expression&quot;&gt;regular expression&lt;/a&gt;. This is a sequence of characters that define a search pattern that you attempt to match against. You&#39;ll find hundreds of different email regular expressions on the internet which give you various queries to validate against. However, they often come with caveats that they make a trade-off between speed and accuracy. You can use one of these to match the given email address with a specific pattern but you may incorrectly accept or reject some email addresses. The official regular expression which matches all email addresses is &lt;a href=&quot;http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html&quot;&gt;ridiculously big&lt;/a&gt;. I can&#39;t imagine attempting to debug this if it doesn&#39;t work as expected in your programming language. While a regular expression will confirm if your email matches a specific pattern, we can&#39;t confirm whether we can send an email to it.&lt;/p&gt;
&lt;h4&gt;Send the user an email&lt;/h4&gt;
&lt;p&gt;A nicer way is to determine if you can &lt;a href=&quot;https://medium.com/hackernoon/the-100-correct-way-to-validate-email-addresses-7c4818f24643&quot;&gt;send an email to the given email address&lt;/a&gt;. This works really well for verifying an email address when signing up for an online service, but it&#39;s not that easy when you need to validate an email in a chatbot flow. Flows in Messenger or WhatsApp can&#39;t wait for your user to check their email and click on a link.&lt;/p&gt;
&lt;h4&gt;Checking the MX record&lt;/h4&gt;
&lt;p&gt;However, we can do something better by checking that the email has a valid domain to send email to. If we find a domain name in the given email address, we can check the DNS (Domain Name Server) records for the domain. These records can tell us the IP address on which the domain is hosted. They can also be used to see if email can be sent to the domain. For this we can check if the domain has an MX (Mail eXchange) record. If it does, we can send email to it.&lt;/p&gt;
&lt;h4&gt;Writing an API service to check for a valid email domain&lt;/h4&gt;
&lt;p&gt;Checking for an MX record does take some time so first we can verify that the email address has the format of an email address. For this you can check for the presence of an @ symbol. If it exists then the user has at least attempted to give us something which is similar to an email address! If you retrieve the rest of the string after the @ symbol, this represents the domain name. In my video below, I use Node.js and the standard &lt;a href=&quot;https://nodejs.org/docs/latest/api/dns.html&quot;&gt;dns library&lt;/a&gt; to determine if an MX record exists for that domain. If it does, then you should be able to send email to that address and we can consider it valid.&lt;/p&gt;
&lt;p&gt;Here&#39;s some example code to retrieve an email address and validate it.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;const dns = require(&#39;dns&#39;);

// The dns library will return:
// ENOTFOUND - if no records exist at all for the domain
// ENODATA - if no MX record was found for the domain,
// or if the user data was invalid
const hasMxRecordError = error =&amp;gt; (
    error &amp;amp;&amp;amp; (error.code === &#39;ENOTFOUND&#39; || error.code === &#39;ENODATA&#39;)
);

// A promise-based method to determine if the
// MX record exists for the given email
const checkValidMxRecord = email =&amp;gt; (
    new Promise((resolve, reject) =&amp;gt; {
        // Determine if email is in the correct format
        const isEmail = email.includes(&#39;@&#39;);
        if (!isEmail) {
            return reject(
                new Error(&#39;Invalid email address does not contain @ symbol&#39;)
            );
        }

        // Split the email address and destructure to find the domain
        // TODO: You could also validate the username if you wanted to
        const [username, domain] = email.split(&#39;@&#39;);

        // Read the DNS records and see if an MX record exists for the domain
        return dns.resolveMx(domain, (error, addresses) =&amp;gt; {
            // Check if any errors occurred
            if (hasMxRecordError(error)) {
                return reject(new Error(&#39;Email has invalid MX record&#39;));
            }
    
            // You may not need the records but we can return them in case
            return resolve(addresses);
        });
    }));
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;To make my APIs more robust, I always return user attributes back to Chatfuel to inform it whether an API has succeeded or not. This allows us to avoid hard coding any messages in the API and gives back control to Chatfuel, or whichever chatbot platform you use, and use that to display the correct user messaging. It&#39;s a good way to inform the user that they&#39;ve potentially typed in their email incorrectly. You can also use this validation check to gate your content to only allow access to people who supply their email address.&lt;/p&gt;
&lt;p&gt;Of course, this method has a flaw in that we can&#39;t confirm that the username is valid without sending an email to it. We&#39;ll find this out when we send an email to them from our mailing list but at least we got halfway there.&lt;/p&gt;
&lt;p&gt;I hope you found this useful. All of the code is available on my &lt;a href=&quot;https://glitch.com/~chatfuel-demo-bot&quot;&gt;Chatfuel demo Glitch project&lt;/a&gt;. Feel free to clone it and use it for your own APIs. If you spot any errors, or have any questions, then please &lt;a href=&quot;/contact&quot;&gt;send me a message&lt;/a&gt;. I love to hear from people and I&#39;m always happy to answer your questions.&lt;/p&gt;
&lt;div class=&quot;i fw5&quot;&gt;
    &lt;p&gt;üëâüèª Want to learn more about JSON? Want to learn about the magic of JSON without being a developer? Get my &lt;a href=&quot;/bots/sign-up-bot-building-for-beginners/&quot; title=&quot;FREE JSON guide&quot;&gt;FREE JSON guide&lt;/a&gt; and you&#39;ll have JSON skills in no time!&lt;/p&gt;
&lt;/div&gt;
</description>
        <pubDate>Sun, 24 Nov 2019 00:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/how-to-validate-an-email-address-using-the-chatfuel-json-api/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/how-to-validate-an-email-address-using-the-chatfuel-json-api/</guid>
      </item><item>
        <title>Lessons Learned From Running A Code Club</title>
        <description>&lt;p&gt;Here in the UK we have an organisation called &lt;a href=&quot;https://www.codeclub.org.uk/&quot;&gt;Code Club&lt;/a&gt; which aims to help all children learn to code. It&#39;s a network of volunteers and educators who run free coding clubs for 9 to 11 year olds. I have two children, aged 7 and 9, and I want to encourage them to learn more about computing and technology and not just watch gaming videos on YouTube. When my eldest son moved from his infant school to his junior school a couple of years ago, the teachers told me how ill prepared they were for the move from Information Communication Technology (ICT) to computing. This was due to ICT being more about how to use a computer rather than how to write computer code. Having over 20 years of professional programming experience, I thought that this would be a good time to get involved to help my son&#39;s school. Unfortunately, due to &lt;a href=&quot;/how-i-almost-died/&quot;&gt;almost dying&lt;/a&gt;, it took a bit longer to help out thank expected but I finally started running a Code Club this year. It&#39;s harder work than I imagined but it&#39;s a fantastically rewarding experience. Here are a some lessons I have learned along the way which could help others.&lt;/p&gt;
&lt;h2&gt;Lessons Learned In Running My Code Club&lt;/h2&gt;
&lt;p&gt;My original plan for my Code Club was to teach one group of children for around 10 weeks. I decided to only run the club for the Y5 and Y6 pupils, ages 9 to 11, and my plan was to start with the basics and continue to build on the projects each week. When the school announced the Code Club it was over-subscribed with around 30 children enrollong. Instead, I ran the club for two 5 week periods with 15 students in each class.&lt;/p&gt;
&lt;h3&gt;Teaching is hard&lt;/h3&gt;
&lt;p&gt;My wife is an English teacher of over 17 years. She laughed at me when I returned home after the first lesson and exclaimed &amp;quot;that was hard work&amp;quot;. Any teachers reading this will also be laughing at my na√Øvety. I blindly assumed that all children would listen and implement the coding lessons I&#39;d prepared. They did. Sometimes.&lt;/p&gt;
&lt;p&gt;Some children will listen. Others, not so much. There&#39;s noise, there are questions, somebody needs to go to the toilet, everyone needs to go to the toilet, somebody is showing the whole class their project and so on. It&#39;s great fun but it can get chaotic. There&#39;s a great article about &lt;a href=&quot;https://blog.codeclub.org.uk/2016/07/13/embracing-chaos-in-your-code-club/&quot;&gt;embracing the chaos&lt;/a&gt; on the Code Club website that everyone should read. I quickly realised that allowing them to do their own thing was part of them building their confidence in computer programming.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Embrace the chaos. It may be hard initally if you&#39;re not an educator and aren&#39;t used to children in a classroom environment. It gets easier and much more fun pretty quickly though.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Class size&lt;/h3&gt;
&lt;p&gt;I had a class size of 15 children in each group. As a non-teacher, this felt like a good class size to be able to control. For the first two weeks of Code Club I was alone in teaching until another parent helper had received his DBS check. It is harder than I imagined to be able to teach a class and answer all of their questions with one teacher and 15 children. Once an additional pair of hands was on-board, it made teaching much easier and big thanks to Dan for helping every week.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Make teaching easier by having a ratio of at least 1 adult helper to 6 or 7 children.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;A variety of programming experience&lt;/h3&gt;
&lt;p&gt;I chose to use &lt;a href=&quot;https://scratch.mit.edu/&quot;&gt;Scratch&lt;/a&gt; for all of my projects. It&#39;s a good choice for drag-and-drop programming and introduces the children to the basics of computing in a simple environment. It avoids complicated syntax errors when using a language such as Python or JavaScript. Most of the children had used Scratch at school but there was a range of abilities. Some questioned the basics while others raced ahead adding new features to their projects. My Code Club is in the school library so I always introduce the lessons with a set of slides on the TV. I introduce the lesson and talk through the basics but then have a set of enhancements that the children could work towards if they have the time. This helped to set the goal for the slower students while challenging the quicker ones. I also shared my version of the game as a challenge to make their&#39;s better than mine.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Consider extra features that the children could add to the project. If you&#39;re not an experienced programmer why not write a list of ideas that the children could add to your resources, even if you&#39;re not sure how to do them.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Preparation of lessons is key&lt;/h3&gt;
&lt;p&gt;It&#39;s perhaps an obvious point to make, especially if you&#39;re a teacher, but you should always run through the Code Club resources a couple of nights before. This helped me to understand the Code Club approach to the problem which often differed to my own. As I mentioned above, I always create a &amp;quot;stretch goal&amp;quot; for the children to try and achieve. This could involve improving the graphics, adding start and end game screens, adding sound and any other fun ideas I could think of. This ended up as a great challenge for me too. Scratch is restrictive when you&#39;re used to writing complex applications or games but working out a Scratch-based way of thinking was great fun.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Run through the lesson the night before and you&#39;ll encounter any issues that the children will have before they do.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Using sound&lt;/h3&gt;
&lt;p&gt;I ran the &amp;quot;Rock Band&amp;quot; project on my first club. The sound of 15 computers blaring out sound effects can be tricky to manage, especially when the children find the music! Ask them to keep the noise down. If you&#39;re lucky they will. You may allow the use of headphones too.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Projects using sound can make for a noisy classroom!&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Adding more graphics&lt;/h3&gt;
&lt;p&gt;Scratch provide the children with great graphics and sound effects but they want to make each project their own. For my initial Rock Band lesson, I also showed them a &lt;a href=&quot;https://scratch.mit.edu/projects/153704607/&quot;&gt;Pikachu version&lt;/a&gt; as I knew seeing a Pokemon would get them engaged. I&#39;d put the graphics on a USB stick but formatted it on my Mac. My fatal mistake was not formatting it for a FAT32 file system so it didn&#39;t work and there was some disappointment. The other issue to consider is whether the computers have internet access and whether the school allow access. You&#39;ll find that they want to download graphics to personalise their projects so you&#39;ll need to decide if this is possible. Thankfully, most schools have good safety policies and internet filtering. If the children can use their own graphics, their projects become their own.&lt;/p&gt;
&lt;p&gt;Show the children the costume editor in Scratch and they can start creating their own sprites or variations of the existing ones. They love doing this but be aware that they will spend the whole lesson drawing sprites if they can.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Discuss with your school what their internet policy is for the children. Allow them to get creative with their own graphics.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Rubber duck debugging&lt;/h3&gt;
&lt;p&gt;In software engineering we have a method of finding problems in our code known as &lt;a href=&quot;https://en.wikipedia.org/wiki/Rubber_duck_debugging&quot;&gt;rubber duck debugging&lt;/a&gt;. The idea is that in telling the problem to someone else, such as a rubber duck, you&#39;ll actually understand the problem and will explain the solution yourself. If you&#39;ve never tried it before, please do. It works! The children sometimes couldn&#39;t work out why their code didn&#39;t work as expected. Instead of pointing out what was wrong, I&#39;d ask them to explain what they&#39;ve done. I&#39;d ask questions about each line of Scratch code. Most of the children would instantly see the problem and could fix it themselves. Computer programming is all about failure. You have to get it wrong to fully understand how to correct it.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: If children have problems, ask them questions about their code. Try not to immediately offer solutions. They&#39;ll often work it out themselves.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Schools can&#39;t afford the best technology&lt;/h3&gt;
&lt;p&gt;I use a MacBook Pro for work. I am a developer who needs high end technology to do my job. Schools are not the same. They have constant budgetary constraints. They need to decide where to spend their hard fought for money. It won&#39;t be on the best computers. My son&#39;s school had reasonably usable Windows laptops with the latest version of Scratch on them. We generally had no issue with them. However, I helped out with teaching some programming at my daughter&#39;s infant school and it is a different story. They had half a room of desktop PCs and around 10 or 12 notebook-style laptops. The desktop PCs were fine but the notebooks had tiny screens and missing keys. The Scratch interface didn&#39;t fit on the full screen meaning that children had to scroll up and down to add new script blocks. It was much harder for the children couldn&#39;t to do this.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Investigate the equipment the schools have before you start. You&#39;ll have to work with what you&#39;ve got but it helps to understand the problems you may encounter before you start.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Show and tell&lt;/h3&gt;
&lt;p&gt;One of the best ideas I used was to have a &amp;quot;show and tell&amp;quot; at the end of the lesson. I didn&#39;t start this until the second week but it finishes off the lesson extremely well. The children like to show their own unique take on the projects. I was often amazed at the direction the children took and it made for interesting learning for me too. Show off their projects on the big screen or projector if you have one. Make sure all of the children watch as it encourages their creativity for next time. Remember though, if you have 15 in the class, it can take quite a while to share each project. I initially gave 10 minutes to do this but ended up needing 15 to 20 minutes in the future weeks.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip: Allow at least 15 minutes before the end of the lesson for the children to show their project to the rest of the class. They&#39;re proud of what they&#39;ve done and it gives them a great sense of achievement in front of their classmates.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Make it fun!&lt;/h3&gt;
&lt;p&gt;Ultimately, you and the children both need to have fun. Some of the children told me &amp;quot;it was awesome - I can&#39;t wait for next week&amp;quot;. It&#39;s been a pleasure to teach them all and I hope tht I&#39;ve influenced some of them to eventually follow a path into software development. If you don&#39;t run a Code Club then why don&#39;t you try? The Code Club website allows you to search for clubs in the local area where you could help out. Or you could start one yourself. You don&#39;t have to be a computer expert to start one. The children will help &lt;strong&gt;you&lt;/strong&gt; if you get stuck!&lt;/p&gt;
&lt;h2&gt;The projects for my club&lt;/h2&gt;
&lt;p&gt;If you&#39;re interested in following a similar structure to my club, here are the projects that we did. I&#39;ve also listed some of the enhancements that I added and have given links to my versions so you can use and alter them.&lt;/p&gt;
&lt;h4&gt;Week 1 - &lt;a href=&quot;https://www.codeclubprojects.org/en-GB/scratch/rock-band/&quot;&gt;Rockband&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;This project gives a great basic introduction to Scratch. It shows how to play sounds, change costumes based upon state and about user input. I expanded upon it with my &lt;a href=&quot;https://scratch.mit.edu/projects/153704607/&quot;&gt;Beatbox Pikachu&lt;/a&gt; version.&lt;/p&gt;
&lt;h4&gt;Week 2 - &lt;a href=&quot;https://www.codeclubprojects.org/en-GB/scratch/ghostbusters/&quot;&gt;Ghost Catcher&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;This is a &amp;quot;whack-a-mole&amp;quot; style gme where you click on ghosts as they appear and disappear to score points. A great introduction to variables which record the score and display a timer. Enhancements could include varying the frequency, size and speed of ghosts and adding a high score. My version shows a complete game with a game over screen. You&#39;ll find my Ghostbusters game &lt;a href=&quot;https://scratch.mit.edu/projects/153704687/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Week 3 - &lt;a href=&quot;https://www.codeclubprojects.org/en-GB/scratch/chatbot/&quot;&gt;Chatbot&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Ths is probably my favourite project. You add code so that Scratch asks a question and the children use the response within their code. It gives a great introduction to computer logic, for example &amp;quot;if...then&amp;quot;. I started simple but then asked them to create their own &amp;quot;artificial intelligence&amp;quot;. My enhanced version is an AI which responds to simple commands such as &amp;quot;hide&amp;quot;, &amp;quot;moonwalk&amp;quot;, &amp;quot;basketball&amp;quot;, &amp;quot;dab&amp;quot;, &amp;quot;bottle flip&amp;quot; and my character responds accordingly. Bottle flipping was one of their favourites and everyone tried to recreate it! üòÑ Here&#39;s &lt;a href=&quot;https://scratch.mit.edu/projects/153704739/&quot;&gt;my version&lt;/a&gt; on the Scratch website.&lt;/p&gt;
&lt;h4&gt;Week 4 - &lt;a href=&quot;https://www.codeclubprojects.org/en-GB/scratch/clone-wars/&quot;&gt;Clone Wars&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;This project was particularly enjoyed by the Y5 children in my second group. It&#39;s a space shoot-em-up with a &lt;a href=&quot;https://www.youtube.com/watch?v=XhYVcwhSWjI&quot;&gt;Galaxians&lt;/a&gt; feel to it. In this you learn about cloning sprites for spawning bullets and enemy AI. This is an interesting project for explaining how I would experiment with variables to create a fun game. Show them how to change the speed of enemies, the time between bullets and what difference it makes to the game. My version adds a shield, lives and a game over screen so it&#39;s almost a real game. My version is on the Scratch website &lt;a href=&quot;https://scratch.mit.edu/projects/153704809/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h4&gt;Week 5 - &lt;a href=&quot;https://www.codeclubprojects.org/en-GB/scratch/flappy-parrot/&quot;&gt;Flappy Parrot&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;This final project was the one that the Y6 children were most excited about. Flappy Bird is an iconic mobile game for most of them and it was great to see their ideas - Flappy Taco anyone? It introduces more complex movement to the children in the form of gravity. It also shows the game developer trick of pretenting the bird moves forward by actually moving the pipes backwards. This was quite a mind-blowing trick for some of the children but great to see them understanding it. This is also a good project to show a full set of game states with. Try adding a start and end screen. Mine used the original Flappy Bird graphics and awarded a medal if you beat the high score. You can find my version of Flappy Bird &lt;a href=&quot;https://scratch.mit.edu/projects/153704839/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Fri, 31 Mar 2017 23:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/lessons-learned-from-running-a-code-club/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/lessons-learned-from-running-a-code-club/</guid>
      </item><item>
        <title>Simple Error Handling For Your Production Express Server</title>
        <description>&lt;p&gt;Error handling is a big part of writing code and it&#39;s something that every developer should think about. When starting to write code, it&#39;s easy to overlook what happens when your code fails. As developers we like to assume we write perfect code. We never do though do we?! If you&#39;re writing a customer facing application then you should always try and gracefully catch any errors and return human-friendly error messages to give a better user experience. This is especially true if you have an application which deals with 3rd party APIs or other external dependencies, like a database server. In these cases, you can&#39;t guarantee that the services will be available and you should be ready to handle this.&lt;/p&gt;
&lt;p&gt;In my current job I write a lot of server-side JavaScript and we have a few &lt;a href=&quot;http://expressjs.com/&quot;&gt;Express&lt;/a&gt; applications running with Node.js. While checking out Twitter this evening I saw an interesting question from top JavaScript afficianado &lt;a href=&quot;http://wesbos.com/&quot;&gt;Wes Bos&lt;/a&gt;. He asked an interesting question about error handling with Express servers:&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;Talk to me about your Express error handling strategy. How (not what package) do you handle app errors as well as model validation fails?&lt;/p&gt;&amp;mdash; Wes Bos (@wesbos) &lt;a href=&quot;https://twitter.com/wesbos/status/831930095967358989&quot;&gt;February 15, 2017&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;p&gt;Our &lt;a href=&quot;https://www.bbc.com/signin&quot;&gt;applications&lt;/a&gt; are used by millions of people each day so we have quite robust error handling for our Express servers. Hence this was a question I am qualified to answer. I&#39;ll explain our approach to error handling using a simple example with some basic Express middleware functions and error handlers. The code uses ES6 syntax and Promises so if you&#39;re not familiar with these, then check out Wes Bos&#39; excellent &lt;a href=&quot;https://es6.io/&quot;&gt;ES6 course&lt;/a&gt; and read up on &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise&quot;&gt;Promises&lt;/a&gt;. I&#39;ve not shown the code for the service calls as it&#39;s not important to know what that code does. What is important is that we ensure that our Express application correctly handles the errors which may occur after we execute the function.&lt;/p&gt;
&lt;h2&gt;Setting Up A Simple Express Application&lt;/h2&gt;
&lt;p&gt;Firstly, we can set up a basic user-facing Express application. It&#39;ll expose a few routes for us:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;/login&lt;/code&gt; - this will display the user login page on a GET request and allow us to POST user credentials to it&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/user&lt;/code&gt; - this will display the user&#39;s data (whatever that may be)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The Express server and routing code could look something like this.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;function startServer(port = 3000) {
    const app = express();

    // Display the user login page
    app.get(&#39;/login&#39;,
        showLoginMiddleware
    );

    // Allow the user to submit their credentials
    app.post(&#39;/login&#39;,
        validateLoginMiddleware,
        showLoginMiddleware
    );

    // Assume that the user is validated before we hit this
    app.get(&#39;/user&#39;, (request, response) =&amp;gt; {
        return response
            .status(200)
            .render(&#39;pages/success&#39;);
    });

    // Mount 404 handler as penultimate middleware
    app.use(notFoundHandler);

    // Final middleware is our catch-all error handler
    app.use(defaultErrorHandler);

    return app.listen(port, () =&amp;gt; {
        logger.info(&#96;Server started on port ${port}&#96;);
    });
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can see that I&#39;ve added two error handlers and these are simple Express middleware functions. The first is &lt;code&gt;notFoundHandler&lt;/code&gt;. This will handle any requests which are application isn&#39;t set up to handle, for example if somebody hits a URL which we haven&#39;t defined. The second is &lt;code&gt;defaultErrorHandler&lt;/code&gt;. This is the most important middleware as it allows us to catch any application errors that we aren&#39;t sure what to do with. I&#39;ll explain how these are implemented shortly.&lt;/p&gt;
&lt;h2&gt;Handling Known Errors&lt;/h2&gt;
&lt;p&gt;The first question Wes asked was what error handling pattern should be used by an Express server in order to handle known developer errors, such as model validation failure or documented API failures. In the server setup above, we declared a GET and POST route for our &lt;code&gt;/login&lt;/code&gt; URL so let&#39;s define some middleware functions for them.&lt;/p&gt;
&lt;p&gt;The first is for the GET request and it simply renders our login page. We can assume that this is a Jade or Pug template which renders a form allowing the user to enter their username and password.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;function showLoginMiddleware(request, response) {
    response.render(&#39;pages/login&#39;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The next middleware is used by our POST route and retrieves the &lt;code&gt;username&lt;/code&gt; and &lt;code&gt;password&lt;/code&gt; properties from our request body. We then pass these to our authentication service which validates that we have a user we know about. Notice that it&#39;s promise based so we can nicely catch our errors but you can achieve the same with a callback if you&#39;re more familiar with them. If our &lt;code&gt;authenticateUser&lt;/code&gt; service succeeds, then we simple redirect the application to our &lt;code&gt;/user&lt;/code&gt; endpoint.&lt;/p&gt;
&lt;p&gt;If the user&#39;s credentials are not valid then we know that our service throws a &lt;code&gt;InvalidCredentialsError&lt;/code&gt; typed &lt;code&gt;Error&lt;/code&gt;. This is because we either wrote the service or we know this from 3rd party API documentation. This typed error contains a &lt;code&gt;message&lt;/code&gt; property which we can show to the user so it&#39;s now a simple case of remembering the error for use in our re-rendered page. In my example, I&#39;m using the &lt;code&gt;response.locals&lt;/code&gt; object to assign an error property which gets used in the subsequent page re-render. I call &lt;code&gt;next()&lt;/code&gt; in order to call the next middleware and this just uses &lt;code&gt;showLoginMiddleware&lt;/code&gt; again which renders the same login page but shows the error message if it exists.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;function validateLoginMiddleware(request, response, next) {
    const {username, password} = request.body;

    // Authenticate the user credentials with our service
    return authenticateUser(username, password)
        .then(() =&amp;gt; {
            // User credentials were correct
            response.redirect(&#39;/user&#39;);
        })
        .catch(InvalidCredentialsError, (loginError) =&amp;gt; {
            // User credentials were incorrect
            // Set an error message
            response.locals.error = loginError.message;

            // Re-render the same page where we display our error message
            next();
        })
        .catch((unknownError) =&amp;gt; {
            // Woah! Something bad happened but we don&#39;t know what
            next(unknownError);
        });
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; I&#39;m using &lt;a href=&quot;http://bluebirdjs.com/docs/api/catch.html&quot;&gt;Bluebird&#39;s typed promise catch method&lt;/a&gt; in the above example.&lt;/p&gt;
&lt;p&gt;Using a Promise returned from our authentication service also allows us to add a final &lt;code&gt;catch&lt;/code&gt; function to our middleware. &lt;em&gt;But why do we need to add this final catch block?&lt;/em&gt; Well our authentication service needs to determine if our user credentials are correct so it could do this by checking with a 3rd party API, such as an OAuth service, or it could be using a database query. What happens if either of these resources is unavailable? They may have heavy load. They might just fail due to unexpected server downtime. Either of these could cause a request timeout or an unknown response. Our &lt;code&gt;catch&lt;/code&gt; block can now handle this more gracefully by passing the error on to the generic Express error handling middleware.&lt;/p&gt;
&lt;h2&gt;Handling Unexpected Application Errors&lt;/h2&gt;
&lt;p&gt;Express allows us to define middleware functions which have access to the request, response and next middleware in the applications request-response cycle. It also gives us the ability to define a default middleware for our error handler. This makes it simple for us to handle two different general error conditions: an error handler for when we don&#39;t match any of our routes (i.e. a 404 handler) and a default error handler for all other Express errors.&lt;/p&gt;
&lt;p&gt;To use a 404 error middleware, we just use the same &lt;code&gt;(request, response, next)&lt;/code&gt; middleware function signature but &lt;strong&gt;we need to ensure it is the last normal middleware in the application&lt;/strong&gt;. This means that it&#39;ll match any route that we don&#39;t already handle with the previous middleware. In the example below, I create a &lt;code&gt;notFound&lt;/code&gt; middleware which displays a &amp;quot;page not found&amp;quot; template. I also add a logger warning. It may not be an error as such but if you&#39;re logging events in your application, and you should be in some form, then it&#39;s useful to see what resource the user is attempting to access.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;function notFoundHandler(request, response) {
    logger.warn(
        &#39;Unhandled resource&#39;,
        {
            statusCode: 404,
            error: &#39;Unknown resource&#39;,
            resource: request.originalUrl
        }
    );

    return response
        .status(404)
        .render(&#39;pages/notFound&#39;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Finally, we have the special Express middleware which allows us to handle errors. In my user authentication middleware above, called &lt;code&gt;validateLoginMiddleware&lt;/code&gt;, you&#39;ll notice that I catch any unknown errors and then call the &lt;code&gt;next&lt;/code&gt; middleware but also pass an error to it i.e. &lt;code&gt;next(uknownError)&lt;/code&gt;. By calling the next middleware with an error parameter, it allows Express to bypass all of the other middleware functions for the current route and instead calls our special error middleware. In the example below, we log the error and also return a 500 error and specific error page. In this we can warn the user that we&#39;re having some problems without letting our application crash. This greatly improves our users experience even if there&#39;s nothing we can do about the error itself.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IMPORTANT:&lt;/strong&gt; The Express error middleware has a specific signature with the parameters &lt;code&gt;(error, request, response, next)&lt;/code&gt;. If you&#39;re using a linter such as ESLint, it will complain that you have an unused parameter in &lt;code&gt;next&lt;/code&gt; if you don&#39;t call it. &lt;strong&gt;If you remove it then the middleware will no longer be called via &lt;code&gt;next(error)&lt;/code&gt; as it no longer matches.&lt;/strong&gt; Ensure that you add an ignore rule for your linter but don&#39;t remove the unused parameter. I learnt this the hard way by fixing the lint warning and wondered why the error middleware wasn&#39;t called! You must also register this error handling middleware &lt;strong&gt;as the last middleware in the application&lt;/strong&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;// eslint-disable-next-line no-unused-vars
function defaultErrorHandler(error, request, response, next) {
    logger.error(&#39;Uncaught error&#39;, {statusCode: 500, error});

    return response
        .status(500)
        .render(&#39;pages/error&#39;);
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Hopefully this has given you a useful insight how to properly use Express middleware for your error handling. In short, make sure you do the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;add a standard middleware for any routes which you don&#39;t handle specifically - assign this to the Express application &lt;strong&gt;as the penultimate route&lt;/strong&gt; and it will act as your 404 error handler&lt;/li&gt;
&lt;li&gt;add an Express error middleware with the additional error parameter as your default error - assign this to the Express application &lt;strong&gt;as the last middleware after all other middleware functions have been registered&lt;/strong&gt; and it will act as your default error handler&lt;/li&gt;
&lt;li&gt;attempt to catch any other model or service errors by using &lt;code&gt;Promise.catch&lt;/code&gt; functions or &lt;code&gt;try/catch&lt;/code&gt; blocks to gracefully handle known errors.&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 15 Feb 2017 00:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/simple-error-handling-for-your-production-express-server/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/simple-error-handling-for-your-production-express-server/</guid>
      </item><item>
        <title>How To Write High Quality Unit Tests</title>
        <description>&lt;p&gt;One of the often asked questions about unit testing is &amp;quot;how do I ensure I&#39;m writing good quality unit tests?&amp;quot; It&#39;s easy to start of down the path of writing unit tests for your code but you need to make sure you&#39;re writing dependable tests which are easy to maintain. In this article, I talk about the defining characteristics of solid unit testing and how to ensure that the quality is high.&lt;/p&gt;
&lt;h3&gt;What is a unit?&lt;/h3&gt;
&lt;p&gt;The first questions to ask is &amp;quot;what is a unit?&amp;quot; when talking about writing your unit tests. There are differing definitions of what a unit actually is, but it&#39;s often defined as &amp;quot;the smallest component that it makes sense to test&amp;quot;. For object-oriented programming, this could be a whole class or an interface but, as with a functional programming approach, it could also be a single method or function. To test the unit you simply have to define your expectations of what it does, given any of the specified inputs. That&#39;s it! If you&#39;re the developer in charge of writing the code then the test defines what you know &lt;strong&gt;will happen&lt;/strong&gt;. If you didn&#39;t write the code under test, you can write your tests based upon your expectations of what you think &lt;strong&gt;should happen&lt;/strong&gt;. If either of these things change then you want your tests to fail. Your unit tests then define a solid contract with your code.&lt;/p&gt;
&lt;h3&gt;What are good qualities of unit tests?&lt;/h3&gt;
&lt;p&gt;Your unit tests should be the first line of defence for your project. As your tests are so important to your code quality, you should always attempt to write high quality unit tests. But what does that actually mean? Let&#39;s find out by looking at some of the features of good quality tests.&lt;/p&gt;
&lt;h3&gt;Human readable and understandable test names&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/human-readable-test-names.png&quot; alt=&quot;Human readable test names&quot;&gt;{: title=&amp;quot;Human readable test names&amp;quot; alt=&amp;quot;Human readable test names&amp;quot;}&lt;/p&gt;
&lt;p&gt;As silly as this may sound, you should spend some time ensuring that your test names make sense. This means that they should show the developer reading them exactly what the code under test does. The tests should be written for you and your team and not for a computer. Make sure that they&#39;re easy to read and make sense as a sentence. An example could be &lt;em&gt;&amp;quot;should add a new user to the database&amp;quot;&lt;/em&gt; or &lt;em&gt;&amp;quot;should call the authentication API with the expected user credentials&amp;quot;&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;An advantage of writing good test names is that you should be able to scan through each test module and see what the feature requirements for the code. This suite of tests should then be treated as living documentation for your project. If your code&#39;s functionality changes then update your test names accordingly.&lt;/p&gt;
&lt;h3&gt;Isolation of dependencies&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/stub-unit-test-dependencies.jpg&quot; alt=&quot;Stub unit test dependencies&quot;&gt;{: title=&amp;quot;Stub unit test dependencies&amp;quot; alt=&amp;quot;Stub unit test dependencies&amp;quot;}&lt;/p&gt;
&lt;p&gt;One of the most important feature of a unit test is that it&#39;s isolated from any other external influences. This ensures that you&#39;re only testing the code that you&#39;ve written and aren&#39;t dependent on the state of other modules. In order to do this you should write &lt;a href=&quot;http://martinfowler.com/bliki/TestDouble.html&quot;&gt;test doubles&lt;/a&gt; to replace your production dependencies for testing purposes. These generally take the form of a stub or mock object which returns the data you specify in order to fulfil your test expectation.&lt;/p&gt;
&lt;p&gt;Some examples of things that you should make sure that you isolate are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Calls to services&lt;/strong&gt; - these could be external 3rd party API calls, for example the Twitter API, or simply function calls to your own services.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Serialisation calls&lt;/strong&gt; - avoid actually serialising your data to real data stores by stubbing these function calls or mocking them with fake objects.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;State&lt;/strong&gt; - ensure that any state of the system under test has pre-conditions which are initialised by you in your test setup. This could involve stubbing your configuration, initialising structures or objects with expected data or again mocking or stubbing external code dependencies.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Provide just one reason to fail&lt;/h3&gt;
&lt;p&gt;A unit test should only have one reason to fail so you should always avoid putting multiple expectations into one test. You want to know exactly why a test fails and you&#39;ll just make it harder if your test contains more than one assertion. By keeping it simple, and using only one test expectation, it allows you to quickly see &lt;strong&gt;why&lt;/strong&gt; a test has failed. This will mean that you write more tests but it makes the code much easier to reason about. You&#39;ll also find that it guides you to write tests to cover more of your code.&lt;/p&gt;
&lt;h3&gt;Make them speedy&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/make-unit-tests-fast.png&quot; alt=&quot;Make Unit Tests Fast&quot;&gt;{: title=&amp;quot;Make unit tests fast&amp;quot; alt=&amp;quot;Make unit tests fast&amp;quot;}&lt;/p&gt;
&lt;p&gt;Your unit tests should execute as quickly as possibly. Each test should have a small scope and should have all of its dependencies stubbed. By avoiding executing production code, such as that which serialises data to a database or uses 3rd party API calls, you can ensure that the whole of your unit test suite runs in a matter of seconds. This gives the team the confidence to run the tests often and will result in much better code quality. You can see from the image above that in one of our projects we run 2193 tests in 18 seconds, approximately 122 tests per second. This total includes integration tests as well as unit tests but is still fast enough for us to include those in every test run.&lt;/p&gt;
&lt;h3&gt;Independent of environment&lt;/h3&gt;
&lt;p&gt;Your unit tests should always be independent of environment. This means that the tests suite passes all of the tests on your machine, your colleagues&#39; machine and any continuous build server. You definitely want to avoid the &amp;quot;it works on my machine&amp;quot; problem.&lt;/p&gt;
&lt;p&gt;Ensure that the unit tests execute the same on all environments by correctly stubbing or mocking any dependencies and setting any state or external data. Also make sure that there is no dependency on other tests. Each test should run in isolation and should not need the result of a previous test in order to execute correctly. In the same vein, make sure that a test doesn&#39;t have any side effects, for example adding data to a database. You need identical data inputs and state each time the test suite runs. If the tests don&#39;t have consistency, and tests begin to fail, your team will lose faith in unit testing and they will quickly be ignored.&lt;/p&gt;
&lt;h3&gt;Tests unit completely&lt;/h3&gt;
&lt;p&gt;While some tests are better than none, the best quality unit tests ensure that all of the code paths are covered. This is often done in combination with test-driven development practices which mean you never write any code without a corresponding test. Even if you write your tests after you&#39;ve written your code, you should try and test every route through your code.&lt;/p&gt;
&lt;p&gt;Another good practice is to attempt to cover all edge cases for your code if possible. You&#39;ll find that you sometimes forget some obscure inputs, or maybe receive input data that you didn&#39;t expect, but try and determine the full requirements of your code and write your tests accordingly. Even if you don&#39;t, it&#39;s still incredibly satisfying to find a new bug, add an edge case test for it that fails as you expect, and then to fix it while still ensuring that all of your previous tests still pass.&lt;/p&gt;
&lt;h3&gt;Ultimately, make unit testing easy&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/make-unit-testing-easy.jpg&quot; alt=&quot;Make unit testing easy&quot;&gt;{: title=&amp;quot;Make unit testing easy&amp;quot; alt=&amp;quot;Make unit testing easy&amp;quot;}&lt;/p&gt;
&lt;p&gt;You should always aim to make your unit tests easy. They should be easy to run, either from a simple terminal command or from your task runner or dependency manager. They should be easy to maintain such that refactoring the internals of your code should result in little work to update your tests as your test expectations will still be met.&lt;/p&gt;
&lt;h3&gt;Simple questions to ask for each unit test&lt;/h3&gt;
&lt;p&gt;The best way to write high quality unit tests is to write the test with these questions in mind:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;What are you testing?&lt;/li&gt;
&lt;li&gt;What should the code you&#39;re testing do?&lt;/li&gt;
&lt;li&gt;What is the actual output of the code under test?&lt;/li&gt;
&lt;li&gt;What is the expected output of the code under test?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you answer all of those questions, you&#39;ll find you quickly have a higher quality unit test suite with high code coverage and you and your team can have much better confidence when deploying to your production environment.&lt;/p&gt;
&lt;p&gt;If you spot any errors or have and questions then please &lt;a href=&quot;/contact&quot;&gt;contact me&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Sun, 13 Nov 2016 00:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/how-to-write-high-quality-unit-tests/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/how-to-write-high-quality-unit-tests/</guid>
      </item><item>
        <title>How To Unit Test Express Routes</title>
        <description>&lt;p&gt;I was swiping through my Twitter timeline the other night when I saw a really interesting tweet from &lt;a href=&quot;https://kentcdodds.com/&quot;&gt;Kent C Dodds&lt;/a&gt;, a great JavaScript developer who works at PayPal, and someone you should really follow on Twitter if you don&#39;t already. He asked the following question.&lt;/p&gt;
&lt;blockquote class=&quot;twitter-tweet&quot; data-lang=&quot;en&quot;&gt;&lt;p lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;[POLL]: Is it reasonable to *unit* test express routes? Or is it better to do an *integration* test of your server (with supertest for ex.)?&lt;/p&gt;&amp;mdash; Kent C. Dodds (@kentcdodds) &lt;a href=&quot;https://twitter.com/kentcdodds/status/794251165844185088&quot;&gt;November 3, 2016&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&quot;//platform.twitter.com/widgets.js&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
&lt;p&gt;I thought the poll posed an interesting question as to whether you should test Express routes or not. As I&#39;m quite an evangelist of test driven development at the BBC, and I like a challenge and love writing code, I thought I&#39;d have a think about it. I like to aim for as much test coverage as possible but I&#39;m pragmatic enough to understand that 100% code coverage doesn&#39;t necessarily mean you&#39;re always testing the right things.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;quot;Yes, you should unit test Express routes&amp;quot;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;My answer to the poll was &amp;quot;Yes, you should unit test Express routes&amp;quot;, which I appreciate goes against the majority who said unit tests weren&#39;t reasonable. At the minimum, I think that you should &lt;strong&gt;definitely&lt;/strong&gt; test Express routes with some solid integration testing. In our team, we use &lt;a href=&quot;https://github.com/visionmedia/supertest&quot;&gt;supertest&lt;/a&gt; for our HTTP expectations and also &lt;a href=&quot;https://github.com/node-nock/nock&quot;&gt;nock&lt;/a&gt; to mock responses from API calls and it works really well for testing full flows on Express routes. I&#39;ll be honest and say that we don&#39;t currently have full unit testing for the Express routes on the three main Node.js projects that our team work on, but having thought about it, I think there are some reasons why we probably should consider it.&lt;/p&gt;
&lt;h2&gt;Reasons you should unit test Express routes&lt;/h2&gt;
&lt;h3&gt;Better code coverage&lt;/h3&gt;
&lt;p&gt;Firstly, it should give you better code coverage. Having 100% code coverage should never be the end goal of your testing efforts, but writing the best tests to assert your expectations of what your code should be doing is. I feel that aiming towards full coverage of your code means that you have complete confidence in it at the unit level, and you can reason that your modules should perform the functions you expect them to.&lt;/p&gt;
&lt;h3&gt;Explicit expectations of middleware used&lt;/h3&gt;
&lt;p&gt;Next, I think it helps that you&#39;re being explicit in the middleware you think you are calling for each route. It&#39;s always a good idea to split your middleware out into separate modules as this makes unit testing of each middleware much clearer by reading the test asserts and it makes writing the code much simpler. By subsequently adding tests for each route, you can also then assert that you&#39;re calling the right middleware. A good example of this would be to verify that you&#39;re adding your authentication layer to the expected routes. You want to know that you need to authenticate your user before they can see your administration, or per-user, routes and this is simple to do with an expectation that the authentication middleware is called on those specific routes.&lt;/p&gt;
&lt;h3&gt;Security best practices&lt;/h3&gt;
&lt;p&gt;Lastly, I&#39;ve recently taken up the role as security champion of our team and have been working with &lt;a href=&quot;http://blog.diniscruz.com/&quot;&gt;Dinis Cruz&lt;/a&gt;, a developer and application security expert, to ensure that our applications are more secure and adhere to &lt;a href=&quot;https://www.owasp.org/index.php/Main_Page&quot;&gt;OWASP&lt;/a&gt; best practices. One of Dinis&#39; suggestions is to write tests which assert the security expectations of your application. In this case, writing tests which assert that the specified routes apply your security middleware feel like an ideal use case for writing unit tests for Express routes in addition to your integration testing. In doing so it gives you much better confidence that you&#39;re writing secure code and that those specified routes are protected.&lt;/p&gt;
&lt;h2&gt;How to write Express route unit tests&lt;/h2&gt;
&lt;p&gt;So it&#39;s easy to say that we should unit test Express routes, but how do you do it in practice? As Kent said in his later tweets, there don&#39;t seem to be any good examples of how to do it so I&#39;ve written a basic Express application and some corresponding tests in this &lt;a href=&quot;https://github.com/MarcL/unit-test-express-routes&quot;&gt;project on GitHub&lt;/a&gt; which show you a good way to set these tests up. We&#39;ll be using &lt;a href=&quot;https://mochajs.org/&quot;&gt;mocha&lt;/a&gt;, &lt;a href=&quot;http://chaijs.com/&quot;&gt;chai&lt;/a&gt;, &lt;a href=&quot;http://sinonjs.org&quot;&gt;sinon&lt;/a&gt;, &lt;a href=&quot;https://github.com/domenic/sinon-chai&quot;&gt;sinon-chai&lt;/a&gt; (for some syntactic sugar) and &lt;a href=&quot;https://github.com/thlorenz/proxyquire&quot;&gt;proxyquire&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Install the project as follows:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-JavaScript&quot;&gt;git clone git@github.com:MarcL/unit-test-express-routes.git
cd unit-test-express-routes
npm install
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you should see a basic Express application in the &lt;code&gt;src/launch.js&lt;/code&gt; module and the corresponding tests in the &lt;code&gt;test/launch.test.js&lt;/code&gt; module. The application starts an Express server on port 7080 and exposes three example routes: &lt;code&gt;/&lt;/code&gt;, &lt;code&gt;/login&lt;/code&gt; and &lt;code&gt;/dashboard&lt;/code&gt;. These are meant to mimic a homepage, a login page and a dashboard page which is only exposed after authentication.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;import express from &#39;express&#39;;

import homepage from &#39;./middleware/homepage&#39;;
import login from &#39;./middleware/login&#39;;
import authenticate from &#39;./middleware/authenticate&#39;;
import dashboard from &#39;./middleware/dashboard&#39;;

function setupRoutes(app) {
    app.get(&#39;/&#39;, homepage);
    app.get(&#39;/login&#39;, login);
    app.get(&#39;/dashboard&#39;,
        authenticate,
        dashboard
    );
}

function start(port = 7080) {
    const app = express();

    setupRoutes(app);

    const server = app.listen(port, () =&amp;gt; {
        console.log(&#96;Server running on: ${port}&#96;);
    });

    return server;
}

export {
    start
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You can see from the code above, there are four example middlewares which have been split into their own modules. Splitting up your middleware like this is always a good idea as it allows you to separate the unit tests for the middeware from the route code. This makes the code much simpler and easy to read and allows you to write clean and understandable tests.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Splitting up your middleware like this is always a good idea as it allows you to separate the unit tests for the middeware from the route code.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;We need to set up our tests so that we can stub the Express application that is created and then we can return a fake server that we can use in our test expectations. As each test needs this fake server to be initialised, I chose to do this using Mocha&#39;s &lt;code&gt;beforeEach&lt;/code&gt; pre-condition block. As we don&#39;t need to return anything when we perform an &lt;code&gt;app.get&lt;/code&gt; to set up our routes which respond to the GET request, we can use &lt;code&gt;sinon&lt;/code&gt; spy. However, we want to return a fake HTTP server for the &lt;code&gt;app.listen&lt;/code&gt; call, so we make this a &lt;code&gt;sinon&lt;/code&gt; stub. We can then set up a fake Express server which is return via a &lt;code&gt;sinon&lt;/code&gt; stub.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;beforeEach(() =&amp;gt; {
    // Initialise our spy and stub
    spyExpressGet = sinon.spy();
    stubExpressListen = sinon.stub();

    // Create fake express application with our spy and stub methods
    fakeExpress = {
        get: spyExpressGet,
        listen: stubExpressListen
    };

    // Return our fake express application when express() is called
    stubExpress = sinon.stub().returns(fakeExpress);

    ...
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Next, we can set up a fake HTTP server which is what we&#39;d expect &lt;code&gt;app.listen&lt;/code&gt; to return. We do this so we can compare it in our test which checks that the app is listening as we expect.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;// We never use the fake HTTP server but we want to compare it
const fakeHttpServer = {};

// app.listen returns a fake HttpServer
stubExpressListen.returns(fakeHttpServer);
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It&#39;s easy to spy on each of the middlewares used for our routes by creating &lt;code&gt;sinon&lt;/code&gt; spies. We don&#39;t need to test any of these middlewares here, so we don&#39;t need to use a stub. You should test each middleware separately from this route code.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;spyHomepage = sinon.spy();
spyLogin = sinon.spy();
spyAuthenticate = sinon.spy();
spyDashboard = sinon.spy();
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We now use &lt;code&gt;proxyquire&lt;/code&gt; to override the module dependencies. This will allow us to inject our fake Express server and to spy on all of the middleware. All of these spies and stubs will be used in our test expectations. The &lt;code&gt;proxyquire&lt;/code&gt; initialisation looks complex, but we&#39;re simply stubbing the call to &lt;code&gt;app.express&lt;/code&gt; so that it returns our &lt;code&gt;stubExpress&lt;/code&gt; and making sure that the calls to &lt;code&gt;import&lt;/code&gt; or &lt;code&gt;require&lt;/code&gt; the middleware modules in the real code will now be using our spies.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;// Use proxyquire to stub required modules and return
// our spies so we can check assertions
server = proxyquire(&#39;../../src/launch&#39;, {
    express: stubExpress,
    &#39;./middleware/homepage&#39; : {default: spyHomepage},
    &#39;./middleware/login&#39;: {default: spyLogin},
    &#39;./middleware/authenticate&#39;: {default: spyAuthenticate},
    &#39;./middleware/dashboard&#39;: {default: spyDashboard}
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The hard part has now been done as we&#39;ve set up our server before each test. We can now inspect the routes and make expectations on them  so let&#39;s take a look at our tests for that.&lt;/p&gt;
&lt;h2&gt;Express route tests&lt;/h2&gt;
&lt;h3&gt;Assertion that our server is listening&lt;/h3&gt;
&lt;p&gt;First, we can write tests to check that our server is returning the expected HTTP server and runs on either the default port or a port we pass when initialising. We have stubbed &lt;code&gt;app.listen&lt;/code&gt; to return a fake HTTP server so we can check that our call to &lt;code&gt;server.start()&lt;/code&gt; returns it correctly. We can also confirm that it is called with either the default port of 7080, or another port that we pass through to the function call. The expectations are simple and readable so our fellow developers know exactly what the code should do. Note, for simplicity I&#39;m using the general &lt;code&gt;sinon.match.func&lt;/code&gt; matcher to match &lt;em&gt;any&lt;/em&gt; function for the second parameter to &lt;code&gt;app.listen&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;    it(&#39;should return expected http server&#39;, () =&amp;gt; {
        const returnedServer = server.start();
        expect(returnedServer).to.eql(fakeHttpServer);
    });

    it(&#39;should listen on default port 7080&#39;, () =&amp;gt; {
        server.start();
        stubExpressListen.should.have.been.calledWithExactly(7080, sinon.match.func)
    });

    it(&#39;should listen on expected port if passed&#39;, () =&amp;gt; {
        const expectedPort = 8888;
        server.start(expectedPort);
        stubExpressListen.should.have.been.calledWithExactly(expectedPort, sinon.match.func)
    });
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can then check each route using our &lt;code&gt;spyExpressGet&lt;/code&gt; which spies on &lt;code&gt;app.get&lt;/code&gt; for our routes. This is a simple case of confirming that each call sets the expected route string and the corresponding middleware(s).&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;it(&#39;should setup default route&#39;, () =&amp;gt; {
    server.start();
    spyExpressGet.should.have.been.calledWithExactly(&#39;/&#39;, spyHomepage);
});

it(&#39;should setup login route&#39;, () =&amp;gt; {
    server.start();
    spyExpressGet.should.have.been.calledWithExactly(&#39;/login&#39;, spyLogin);
});

it(&#39;should setup dashboard route&#39;, () =&amp;gt; {
    server.start();
    spyExpressGet.should.have.been.calledWithExactly(
        &#39;/dashboard&#39;,
        spyAuthenticate,
        spyDashboard
    );
});
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We use sinon&#39;s &lt;code&gt;calledWithExactly&lt;/code&gt;, albeit using the syntactic sugar of &lt;code&gt;sinon-chai&lt;/code&gt;, to assert that we&#39;re setting the exact middleware for each route. This now gives us complete confidence that each route is only using the middleware that it should.&lt;/p&gt;
&lt;p&gt;Notice that I&#39;ve only stubbed the GET requests in my example project. If you wanted to validate the other routes which use other HTTP verbs then you should create a spy or stub for it and pass it into the fake Express application &lt;code&gt;fakeExpress&lt;/code&gt;. You can then assert your expectations that &lt;code&gt;app.post&lt;/code&gt;, &lt;code&gt;app.put&lt;/code&gt; or &lt;code&gt;app.delete&lt;/code&gt; are called with the expected route string and middleware.&lt;/p&gt;
&lt;h2&gt;tl;dr&lt;/h2&gt;
&lt;p&gt;Hopefully this was an easy-to-read explanation of how to create unit tests for Express routes. In case there is too much text to read above, my opinion is that, yes, I think you can easily unit test your Express routes and you probably should. You should do the following if you&#39;re planning to do so:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Use &lt;code&gt;proxyquire&lt;/code&gt; to override dependencies so that you can stub/spy your express application and middleware functions&lt;/li&gt;
&lt;li&gt;Use &lt;code&gt;sinon&lt;/code&gt; to stub your middleware, which you should have already extracted to their own modules&lt;/li&gt;
&lt;li&gt;Use these stubs to assert your expectations that the Express application routes use the correct middleware&lt;/li&gt;
&lt;li&gt;These tests are an additional layer of confidence and are especially useful for security concerns&lt;/li&gt;
&lt;li&gt;You should &lt;strong&gt;always&lt;/strong&gt; have additional integration tests which test the full flow of the routes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you&#39;ve got any questions, need any clarification or have any comments on this then please &lt;a href=&quot;/contact&quot;&gt;contact me&lt;/a&gt; or tweet at me.&lt;/p&gt;
</description>
        <pubDate>Sun, 06 Nov 2016 00:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/how-to-unit-test-express-routes/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/how-to-unit-test-express-routes/</guid>
      </item><item>
        <title>Halloween Sound Effects Using Spotify And Raspberry Pi</title>
        <description>&lt;p&gt;For Halloween back in 2015, I had an unused Raspberry Pi and decided that I should make a Halloween project in order to learn electronics again, and to scare the local children as they came trick or treating. I connected the Raspberry Pi GPIO pins to a breadboard with a &lt;a href=&quot;https://www.coolcomponents.co.uk/big-dome-push-button-red.html&quot;&gt;big red dome push button&lt;/a&gt;. I hid the Pi and electronics inside a shoe box painted black, and made it look like a spooky spider as you can see in the picture below.&lt;/p&gt;
&lt;blockquote class=&quot;instagram-media&quot; data-instgrm-captioned data-instgrm-version=&quot;7&quot; style=&quot; background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);&quot;&gt;&lt;div style=&quot;padding:8px;&quot;&gt; &lt;div style=&quot; background:#F8F8F8; line-height:0; margin-top:40px; padding:50.0% 0; text-align:center; width:100%;&quot;&gt; &lt;div style=&quot; background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;&quot;&gt;&lt;/div&gt;&lt;/div&gt; &lt;p style=&quot; margin:8px 0 0 0; padding:0 4px;&quot;&gt; &lt;a href=&quot;https://www.instagram.com/p/9eGMutCXUh/&quot; style=&quot; color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;&quot; target=&quot;_blank&quot;&gt;Our Raspberry Pi powered Halloween spider. Press the big red button if you dare! LEDs to be added tonight. #halloween #spider #raspberrypi #spooky&lt;/a&gt;&lt;/p&gt; &lt;p style=&quot; color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;&quot;&gt;A photo posted by Marc Littlemore (@marclittlemore) on &lt;time style=&quot; font-family:Arial,sans-serif; font-size:14px; line-height:17px;&quot; datetime=&quot;2015-10-30T17:33:27+00:00&quot;&gt;Oct 30, 2015 at 10:33am PDT&lt;/time&gt;&lt;/p&gt;&lt;/div&gt;&lt;/blockquote&gt;
&lt;script async defer src=&quot;//platform.instagram.com/en_US/embeds.js&quot;&gt;&lt;/script&gt;
&lt;p&gt;Unfortunately, this year I&#39;ve had a major operation so wasn&#39;t feeling up to recreating or bettering my Raspberry Pi project from last year. Instead, I decided to simplify it in order to play random spooky sound effects via the Raspberry Pi and combine it with some spooky ambient music from Spotify. This is a simple project to set up so read on if you want to scare your local trick or treaters!&lt;/p&gt;
&lt;h3&gt;What You&#39;ll Need&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;A Raspberry Pi (v2/3 or Zero) and SD card with Raspbian installed&lt;/li&gt;
&lt;li&gt;A PC or Mac with a Spotify account&lt;/li&gt;
&lt;li&gt;An audio mixer (or an input into your Mac or PC for software mixing)&lt;/li&gt;
&lt;li&gt;A set of speakers&lt;/li&gt;
&lt;li&gt;Some audio cables (probably 3.5mm but it will depend on your setup)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first thing you&#39;ll need to do is to install Node.js on the Rasbperry Pi, assuming that you haven&#39;t already. You&#39;ll also need &lt;code&gt;git&lt;/code&gt; installed for for cloning the project from GitHub, but this should come with the standard Rasbian install.&lt;/p&gt;
&lt;p&gt;Next you&#39;ll need your PC or Mac up and running and you&#39;ll want Spotify on it. You can use a Spotify free account but bear in mind that you&#39;ll have adverts popping up which might not scare the neighbours as much as the spooky music will. Alternatively, you can use your own playlist of haunting music or find another one on SoundCloud or YouTube. Again, just watch out for adverts playing or you&#39;ll ruin the effect.&lt;/p&gt;
&lt;p&gt;You&#39;ll need a set of speakers attached to your computer in some way. I run the output of my PC to an amplifier and speakers so I can boost the volume, but you can just use a small pair of computer speakers straight from the computer. Just make sure they&#39;re loud enough for people to be able to hear them. I kept my speakers indoors and put them by open windows but if you can run your speakers outside, and they&#39;re waterproof, then that&#39;ll work too.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/stanton-dj-mixer.jpg&quot; alt=&quot;Stanton DJ Mixer&quot;&gt;{: title=&amp;quot;Stanton DJ Mixer&amp;quot; alt=&amp;quot;Stanton DJ Mixer&amp;quot;}&lt;/p&gt;
&lt;p&gt;Finally, you&#39;ll need something to mix the two audio sources together. I&#39;ve spent nearly 30 years DJing so I had my Stanton DJ mixer to hand and plugged both the PC and the Raspberry Pi into it using RCA cables. This allowed me to alter the volumes of the two input sources and the final volume of the output to my amplifier. If you don&#39;t have an audio mixer, you can easily achieve the same thing by using a software mixer on your PC or Mac. Simply attach the output of the Raspberry Pi to the microphone input of your computer using a 3.5mm RCA cable and start the audio mixer in your settings or preferences panel. Note that the output of the Raspberry Pi seems to be really quiet in comparison to the output from the PC. You may be able to change this but I didn&#39;t investigate it too much. It just means that you&#39;ll need to make the Pi audio a lot higher than that from the PC using your hardware or software mixer.&lt;/p&gt;
&lt;h3&gt;Install Node.js on your Raspberry Pi&lt;/h3&gt;
&lt;p&gt;As I love working with Node.js and JavaScript, I decided that this was an easy way to get a project up and running. I installed Node when I first got the Raspberry Pi back in April 2015 so I have version 0.10 by following &lt;a href=&quot;http://weworkweplay.com/play/raspberry-pi-nodejs/&quot;&gt;this guide&lt;/a&gt;. However, at the time of writing, I think the easiest way to install v4.2.1 is by following the instructions on the &lt;a href=&quot;https://github.com/nathanjohnson320/node_arm&quot;&gt;Node Arm GitHub project&lt;/a&gt; which does the following:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;wget http://node-arm.herokuapp.com/node_latest_armhf.deb
sudo dpkg -i node_latest_armhf.deb
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You may need to update the &lt;code&gt;gcc&lt;/code&gt; compilers too, dependent on what version of Raspbian you&#39;re using, but follow the Node Arm guide if you need to do that.&lt;/p&gt;
&lt;p&gt;As Linux doesn&#39;t have the best out-of-the-box audio support, you&#39;ll also have to install the &lt;a href=&quot;http://www.alsa-project.org/main/index.php/Main_Page&quot;&gt;Advanced Linux Sound Architecture (ALSA)&lt;/a&gt; library to allow easier playback of MP3 files. One of the NPM packages used is &lt;a href=&quot;https://github.com/TooTallNate/node-speaker&quot;&gt;node-speaker&lt;/a&gt; and it relies on this library to play audio files. It should be a simple installation using &lt;code&gt;apt-get&lt;/code&gt; on the Raspberry Pi as follows:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;sudo apt-get install libasound2-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;h3&gt;Install the code&lt;/h3&gt;
&lt;p&gt;Next you&#39;ll need to install my Halloween Pi project in order to play the random sounds. As mentioned above, the original project used a button and some LEDs last year so the master branch of the &lt;a href=&quot;https://github.com/MarcL/halloweenpi&quot;&gt;Halloweenpi GitHub project&lt;/a&gt; contains that code that uses the GPIOs to send signals from the buttons and to the LEDs. However, I&#39;ve added a branch which just plays random sound effects in the &lt;code&gt;random-play-sounds&lt;/code&gt; branch. Just clone the project from this specific branch and install all of the dependencies:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;git clone -b random-play-sounds git@github.com:MarcL/halloweenpi.git
cd halloweenpi
npm install
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After installation you should have the project and all of the samples necessary. Run the project and you should start hearing sound effects at intervals of between 15 and 40 seconds. I found this to be about right so that you actually get to hear them without them being too repetitive.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;npm start
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/raspberry-pi-spooky-halloween-sound-effects.jpg&quot; alt=&quot;Raspberry Pi and Spotify&quot;&gt;{: title=&amp;quot;Raspberry Pi and Spotify Setup&amp;quot; alt=&amp;quot;Raspberry Pi and Spotify Setup&amp;quot;}&lt;/p&gt;
&lt;p&gt;Now you need to also play the spooky ambient music from a Spotify playlist. I created this &lt;a href=&quot;https://open.spotify.com/user/marclittlemore/playlist/18JeNeypZVxJLMqVcGvR84&quot;&gt;Spotify Playlist of spooky Halloween noises&lt;/a&gt; which you can use. It&#39;s nearly 7 hours long so it should be enough for playing throughout the night but feel free to make your own too. You&#39;ll have to use your audio mixer to determine the correct balance between the ambient music from Spotify and the one-shot sound effects triggered by the Raspberry Pi. As I mentioned earlier, the Raspberry Pi output seems to be incredibly quiet so I probably had my inputs at around 20% of the PC output mixed with 100% of the Pi output.&lt;/p&gt;
&lt;p&gt;All you need to do now is leave this running and position your speakers in a place, and at a volume, where they can be heard by your visitors. A lot of children and their parents commented about how great this sounded so I was pleased with the eventual outcome.&lt;/p&gt;
&lt;p&gt;Here&#39;s a video of it running in my study, the speakers are hidden behind the curtains with the windows open so it could be heard from the street.&lt;/p&gt;
&lt;div class=&quot;aspect-ratio aspect-ratio--16x9 overflow-hidden mw-100&quot;&gt;
    &lt;iframe
        class=&quot;absolute top-0 left-0 w-100 h-100&quot;
        src=&quot;https://www.youtube.com/embed/&quot;
        frameborder=&quot;0&quot;
        allowfullscreen&gt;
    &lt;/iframe&gt;
&lt;/div&gt;
&lt;h3&gt;Updating the sound effects&lt;/h3&gt;
&lt;p&gt;If you want to update the sound effects that are being played then it&#39;s really simple. First, you need to add the MP3 files to the &lt;code&gt;/assets&lt;/code&gt; directory. Secondly, you need to update the config file which points at them. I chose to be explicit in what sound effects I wanted playing rather than just playing every file it finds in the assets directory. Just update the &lt;code&gt;/config/config.js&lt;/code&gt; array of paths to the sound effects and add your new effects, or remove any that you don&#39;t want.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-javascript&quot;&gt;module.exports = {
    soundFiles: [
        &#39;./assets/cuckoo-clock.mp3&#39;,
        &#39;./assets/foghorn-doorbell.mp3&#39;,
        &#39;./assets/ghost-scream.mp3&#39;,
        &#39;./assets/evil-laugh.mp3&#39;,
        &#39;./assets/female-scream.mp3&#39;,
        &#39;./assets/funeral-bells.mp3&#39;,
        &#39;./assets/howling-wolf.mp3&#39;,
        &#39;./assets/cat-scream.mp3&#39;,
        &#39;./assets/woman-shrill-scream.mp3&#39;,
        &#39;./assets/thriller-laugh.mp3&#39;,
        &#39;./assets/glados-hello-friend.mp3&#39;,
        &#39;./assets/glados-hello-where-are-you.mp3&#39;,
        &#39;./assets/glados-i-see-you.mp3&#39;,
        &#39;./assets/glados-laugh.mp3&#39;,
        &#39;./assets/glados-come-over-here.mp3&#39;,
        &#39;./assets/dalek-exterminate.mp3&#39;
       	]
};
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I hope this guide helps you to easily set up your own Halloween Raspberry Pi spooky sound player. If you have any questions then post them below and I&#39;ll answer them, or raise and bugs as GitHub issues and I can get them fixed.&lt;/p&gt;
</description>
        <pubDate>Fri, 04 Nov 2016 00:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/spooky-halloween-sound-effects-with-raspberry-pi-and-spotify/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/spooky-halloween-sound-effects-with-raspberry-pi-and-spotify/</guid>
      </item><item>
        <title>How To Find Bugs Using Git Bisect With This Easy Guide</title>
        <description>&lt;p&gt;A source control system is an essential tool if you&#39;re writing software, even for your own side projects. Although I&#39;ve used many version control software over the past 20+ years of development, I&#39;ve only been using &lt;code&gt;git&lt;/code&gt; for the past 3 or 4 years. However it&#39;s quickly become my version control of choice due to its ability to quickly create branches, and its distributed nature. It&#39;s easy to master the basics of &lt;code&gt;git&lt;/code&gt; but, as with most pieces of software, there&#39;s a lot of power available if you choose to go beyond them.&lt;/p&gt;
&lt;p&gt;One &lt;code&gt;git&lt;/code&gt; command that you might not have seen or used before is
&lt;code&gt;git bisect&lt;/code&gt;, which is something I&#39;ve only recently started using too. It&#39;s a great tool for quickly tracking down bugs in your project so let&#39;s take a look at how we can use it.&lt;/p&gt;
&lt;h3&gt;A wild bug appears&lt;/h3&gt;
&lt;p&gt;I&#39;m currently working on some high-traffic Node.js projects for work and, as I normally do at the start of a new task, I ran &lt;code&gt;git pull&lt;/code&gt; to ensure I had the latest code from our master branch, and then ran &lt;code&gt;npm install&lt;/code&gt; to update any dependencies. I ran the tests to check everything was ok but an odd thing happened: our test suite hung when it finished although all of the tests still passed. &lt;strong&gt;WHAT?&lt;/strong&gt; Time to investigate.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/posts/a-wild-bug-appeared.jpg&quot; alt=&quot;A wild bug appears&quot;&gt;{:title=&amp;quot;A wild bug appears&amp;quot;}&lt;/p&gt;
&lt;p&gt;I had no idea why this bug had crept into the project, nor when it first appeared in the master branch. My initial thought was that it was the last pull request that had been merged, so I checked out the previous merge instead but again, the tests were still hanging. This felt like a perfect opportunity to try out &lt;code&gt;git bisect&lt;/code&gt; for the first time in order to quickly work out which commit had caused the error.&lt;/p&gt;
&lt;h3&gt;What does the &amp;quot;git bisect&amp;quot; command do?&lt;/h3&gt;
&lt;p&gt;Bisect performs a &lt;a href=&quot;https://en.wikipedia.org/wiki/Binary_search_algorithm&quot;&gt;binary search&lt;/a&gt; to quickly find out the revision that caused a bug in your project&#39;s history. You do this by telling it which was the &amp;quot;bad&amp;quot; commit, the one which contains the bug, and which was a &amp;quot;good&amp;quot; commit, one in which you think the bug wasn&#39;t there. You can then use &lt;code&gt;git bisect&lt;/code&gt; to pick a commit which is halfway between the two endpoints and you determine whether that one is bad or good. This can be repeated by choosing the revision between these two points until you determine the specific commit which caused the bug. It&#39;s then up to you to look at the code to see what has changed and is probably the cause.&lt;/p&gt;
&lt;h3&gt;The &amp;quot;git bisect&amp;quot; process&lt;/h3&gt;
&lt;p&gt;The first thing we need to do is tell &lt;code&gt;git&lt;/code&gt; that we&#39;re about to start using bisect by using the &lt;code&gt;git bisect start&lt;/code&gt; command. Before you do this, you should make sure you&#39;ve committed or stashed any local changes to avoid losing any work as it will checkout each revision as we attempt to find the version containing the bug.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;git bisect start
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The next step is to determine when the bug first occurred and when we think that the repository was ok, and tell &lt;code&gt;git bisect&lt;/code&gt; which commit versions these were. This allows it to determine the range of revisions to search through.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;# Use this if the bug occurs in the current HEAD revision
git bisect bad HEAD

# But if the bug occurs in a specific revision then use its SHA hash
git bisect bad 62c5fa0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;For the good revision, you can choose an arbitrary place in the past but the more commits that have happened between the two endpoints, the more potential revisions &lt;code&gt;git bisect&lt;/code&gt; will have to check. This will depend on the speed of development in your project but it&#39;s probably wise to not choose a revision in time that was not too far away.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;# Choose your good revision
git bisect good da5e24d
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now that you&#39;ve chosen your two endpoints, &lt;code&gt;git bisect&lt;/code&gt; will choose a revision that&#39;s in the middle of these two and tell you how many more revisions it will need to check from this point.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; git bisect good da5e24d
Bisecting: 54 revisions left to test after this (roughly 6 steps)
[dac781864e62c49b279c122c42d447ed26ad16e2] Merge pull request #100 from features/my-feature
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It&#39;s now a process of elimination to determine which specific commit caused the bug. You do this by running your test suite or using your project to see if the bug is still present in the current revision. At this point &lt;code&gt;git bisect&lt;/code&gt; wants to know if this commit is good or bad so you answer &lt;code&gt;git bisect good&lt;/code&gt; or &lt;code&gt;git bisect bad&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; git bisect bad
Bisecting: 27 revisions left to test after this (roughly 5 steps)
[4f455b6e42487657e0492305f025dd82021735d5] some commit message from this revision
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In my case, the &lt;code&gt;gulp&lt;/code&gt; task was still hanging so I answered that the commit was bad. The revisions are then split into two again and you need to continue to answer whether the revisions are good or bad until you reach the last revision and find the guilty commit. At this point &lt;code&gt;git bisect&lt;/code&gt; will show you which commit caused the problem and you can check the code in this revision to determine what has changed.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;02ce44a7491e9b0151169647115f9a073513e0ce is the first bad commit
commit 02ce44a7491e9b0151169647115f9a073513e0ce
Author: some-author &amp;lt;some-author@gmail.com&amp;gt;
Date:   Mon Sep 12 13:59:20 2016 +0100

    Added some code that might break! :D
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Once you&#39;ve determined the cause, you&#39;ll want to finish your current &lt;code&gt;git bisect&lt;/code&gt; session. For this you just use the &lt;code&gt;reset&lt;/code&gt; command and it will reset to your &lt;strong&gt;HEAD&lt;/strong&gt; to where you were before you started.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;git bisect reset
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Make sure you reset otherwise you will find your local working directory in a strange state, having checked out out a previous revision of the project.&lt;/p&gt;
&lt;h3&gt;Pro-tip: Bisect automation&lt;/h3&gt;
&lt;p&gt;Manually finding the bugs in your code is helped by using &lt;code&gt;git bisect&lt;/code&gt; but you can make things even faster by automating the process. You simply have to pass a script to be executed by &lt;code&gt;git bisect run&lt;/code&gt;. Doing this will run the script against each bisected commit in order to determine which one causes the script to fail.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&quot;language-shell&quot;&gt;# Set up our start and endpoints to check against
git bisect start
git bisect bad 62c5fa0
git bisect good da5e24d

# Run our gulp task which executes our
# test suite for each bisected commit
git bisect run gulp test
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;You&#39;ll have to ensure the script that you&#39;re using fails with a non-zero return value for this to work. For the code that fails in my above discussion, our test suite hung so it wasn&#39;t as easy to use automation here.&lt;/p&gt;
&lt;h3&gt;Conclusion: Use &amp;quot;git bisect&amp;quot;&lt;/h3&gt;
&lt;p&gt;As you can see, using &lt;code&gt;git bisect&lt;/code&gt; is an easy way to quickly determine where defects have crept into a &lt;code&gt;git&lt;/code&gt; project. You should start using it as its an effective tool to understand. For more information have a read of this great git SCM article on &lt;a href=&quot;https://git-scm.com/book/en/v2/Git-Tools-Debugging-with-Git&quot;&gt;debugging with git&lt;/a&gt;. Also, take some time to look at the &lt;a href=&quot;https://git-scm.com/docs/git-bisect&quot;&gt;git bisect documentation&lt;/a&gt; too.&lt;/p&gt;
</description>
        <pubDate>Wed, 28 Sep 2016 23:00:00 GMT</pubDate>
        <link>https://www.marclittlemore.com/how-to-find-bugs-using-git-bisect-with-this-easy-guide/</link>
        <guid isPermaLink="true">https://www.marclittlemore.com/how-to-find-bugs-using-git-bisect-with-this-easy-guide/</guid>
      </item></channel>
</rss>
